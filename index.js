/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var r={d:(c,l)=>{for(var u in l)r.o(l,u)&&!r.o(c,u)&&Object.defineProperty(c,u,{enumerable:!0,get:l[u]})},o:(r,c)=>Object.prototype.hasOwnProperty.call(r,c)};function _slicedToArray(r,c){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,c){var l=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=l){var u,p,h,m,y=[],v=!0,g=!1;try{if(h=(l=l.call(r)).next,0===c){if(Object(l)!==l)return;v=!1}else for(;!(v=(u=h.call(l)).done)&&(y.push(u.value),y.length!==c);v=!0);}catch(r){g=!0,p=r}finally{try{if(!v&&null!=l.return&&(m=l.return(),Object(m)!==m))return}finally{if(g)throw p}}return y}}(r,c)||function _unsupportedIterableToArray(r,c){if(r){if("string"==typeof r)return _arrayLikeToArray(r,c);var l={}.toString.call(r).slice(8,-1);return"Object"===l&&r.constructor&&(l=r.constructor.name),"Map"===l||"Set"===l?Array.from(r):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?_arrayLikeToArray(r,c):void 0}}(r,c)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _arrayLikeToArray(r,c){(null==c||c>r.length)&&(c=r.length);for(var l=0,u=Array(c);l<c;l++)u[l]=r[l];return u}function registerSettings(){!function registerSettingsArray(r){for(var c=0,l=Object.entries(r);c<l.length;c++){var p=_slicedToArray(l[c],2),h=p[0],m=p[1];game.settings.register(u,h,m)}}({showWeaponsItems:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showWeaponsItems.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showWeaponsItems.hint"),scope:"world",config:!0,type:Boolean,default:!1,onChange:function onChange(r){ui.ARGON.constructor.DND5E.itemTypes.consumable=ui.ARGON.constructor.DND5E.itemTypes.consumable.filter(function(r){return"weapon"!==r}),r&&ui.ARGON.constructor.DND5E.itemTypes.consumable.push("weapon"),ui.ARGON.refresh()}},showClassActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showClassActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showClassActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(r){ui.ARGON.constructor.DND5E.mainBarFeatures=ui.ARGON.constructor.DND5E.mainBarFeatures.filter(function(r){return"class"!==r}),r&&ui.ARGON.constructor.DND5E.mainBarFeatures.push("class"),ui.ARGON.refresh()}},condenseClassActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.condenseClassActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.condenseClassActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}},explodeItemActivities:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.explodeItemActivities.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.explodeItemActivities.hint"),scope:"world",config:!0,type:String,default:"only-weapons",choices:{"only-weapons":"enhancedcombathud-dnd5e.settings.explodeItemActivities.only-weapons",always:"enhancedcombathud-dnd5e.settings.explodeItemActivities.always",never:"enhancedcombathud-dnd5e.settings.explodeItemActivities.never"},onChange:function onChange(){setExplodeItemActivities(),ui.ARGON.refresh()}},macroPanel:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.macroPanel.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.macroPanel.hint"),scope:"world",config:!0,type:Boolean,default:!1,requiresReload:!0,onChange:function onChange(){return ui.ARGON.refresh()}},switchEquip:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.switchEquip.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.switchEquip.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}},showSpecialActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showSpecialActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showSpecialActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}}})}function echDnd5e_typeof(r){return echDnd5e_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},echDnd5e_typeof(r)}function ownKeys(r,c){var l=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);c&&(u=u.filter(function(c){return Object.getOwnPropertyDescriptor(r,c).enumerable})),l.push.apply(l,u)}return l}function _objectSpread(r){for(var c=1;c<arguments.length;c++){var l=null!=arguments[c]?arguments[c]:{};c%2?ownKeys(Object(l),!0).forEach(function(c){_defineProperty(r,c,l[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(l)):ownKeys(Object(l)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(l,c))})}return r}function _defineProperty(r,c,l){return(c=_toPropertyKey(c))in r?Object.defineProperty(r,c,{value:l,enumerable:!0,configurable:!0,writable:!0}):r[c]=l,r}function echDnd5e_slicedToArray(r,c){return function echDnd5e_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function echDnd5e_iterableToArrayLimit(r,c){var l=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=l){var u,p,h,m,y=[],v=!0,g=!1;try{if(h=(l=l.call(r)).next,0===c){if(Object(l)!==l)return;v=!1}else for(;!(v=(u=h.call(l)).done)&&(y.push(u.value),y.length!==c);v=!0);}catch(r){g=!0,p=r}finally{try{if(!v&&null!=l.return&&(m=l.return(),Object(m)!==m))return}finally{if(g)throw p}}return y}}(r,c)||echDnd5e_unsupportedIterableToArray(r,c)||function echDnd5e_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function echDnd5e_regeneratorRuntime(){var r=echDnd5e_regenerator(),c=r.m(echDnd5e_regeneratorRuntime),l=(Object.getPrototypeOf?Object.getPrototypeOf(c):c.__proto__).constructor;function n(r){var c="function"==typeof r&&r.constructor;return!!c&&(c===l||"GeneratorFunction"===(c.displayName||c.name))}var u={throw:1,return:2,break:3,continue:3};function a(r){var c,l;return function(p){c||(c={stop:function stop(){return l(p.a,2)},catch:function _catch(){return p.v},abrupt:function abrupt(r,c){return l(p.a,u[r],c)},delegateYield:function delegateYield(r,u,h){return c.resultName=u,l(p.d,echDnd5e_regeneratorValues(r),h)},finish:function finish(r){return l(p.f,r)}},l=function t(r,l,u){p.p=c.prev,p.n=c.next;try{return r(l,u)}finally{c.next=p.n}}),c.resultName&&(c[c.resultName]=p.v,c.resultName=void 0),c.sent=p.v,c.next=p.n;try{return r.call(this,c)}finally{p.p=c.prev,p.n=c.next}}}return(echDnd5e_regeneratorRuntime=function _regeneratorRuntime(){return{wrap:function wrap(c,l,u,p){return r.w(a(c),l,u,p&&p.reverse())},isGeneratorFunction:n,mark:r.m,awrap:function awrap(r,c){return new echDnd5e_OverloadYield(r,c)},AsyncIterator:echDnd5e_regeneratorAsyncIterator,async:function async(r,c,l,u,p){return(n(c)?echDnd5e_regeneratorAsyncGen:echDnd5e_regeneratorAsync)(a(r),c,l,u,p)},keys:echDnd5e_regeneratorKeys,values:echDnd5e_regeneratorValues}})()}function echDnd5e_regeneratorValues(r){if(null!=r){var c=r["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],l=0;if(c)return c.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length))return{next:function next(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}}}throw new TypeError(echDnd5e_typeof(r)+" is not iterable")}function echDnd5e_regeneratorKeys(r){var c=Object(r),l=[];for(var u in c)l.unshift(u);return function e(){for(;l.length;)if((u=l.pop())in c)return e.value=u,e.done=!1,e;return e.done=!0,e}}function echDnd5e_regeneratorAsync(r,c,l,u,p){var h=echDnd5e_regeneratorAsyncGen(r,c,l,u,p);return h.next().then(function(r){return r.done?r.value:h.next()})}function echDnd5e_regeneratorAsyncGen(r,c,l,u,p){return new echDnd5e_regeneratorAsyncIterator(echDnd5e_regenerator().w(r,c,l,u),p||Promise)}function echDnd5e_regeneratorAsyncIterator(r,c){function n(l,u,p,h){try{var m=r[l](u),y=m.value;return y instanceof echDnd5e_OverloadYield?c.resolve(y.v).then(function(r){n("next",r,p,h)},function(r){n("throw",r,p,h)}):c.resolve(y).then(function(r){m.value=r,p(m)},function(r){return n("throw",r,p,h)})}catch(r){h(r)}}var l;this.next||(echDnd5e_regeneratorDefine2(echDnd5e_regeneratorAsyncIterator.prototype),echDnd5e_regeneratorDefine2(echDnd5e_regeneratorAsyncIterator.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),echDnd5e_regeneratorDefine2(this,"_invoke",function(r,u,p){function f(){return new c(function(c,l){n(r,p,c,l)})}return l=l?l.then(f,f):f()},!0)}function echDnd5e_regenerator(){var r,c,l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",p=l.toStringTag||"@@toStringTag";function i(l,u,p,m){var y=u&&u.prototype instanceof Generator?u:Generator,v=Object.create(y.prototype);return echDnd5e_regeneratorDefine2(v,"_invoke",function(l,u,p){var m,y,v,g=0,D=p||[],b=!1,_={p:0,n:0,v:r,a:d,f:d.bind(r,4),d:function d(c,l){return m=c,y=0,v=r,_.n=l,h}};function d(l,u){for(y=l,v=u,c=0;!b&&g&&!p&&c<D.length;c++){var p,m=D[c],A=_.p,w=m[2];l>3?(p=w===u)&&(v=m[(y=m[4])?5:(y=3,3)],m[4]=m[5]=r):m[0]<=A&&((p=l<2&&A<m[1])?(y=0,_.v=u,_.n=m[1]):A<w&&(p=l<3||m[0]>u||u>w)&&(m[4]=l,m[5]=u,_.n=w,y=0))}if(p||l>1)return h;throw b=!0,u}return function(p,D,A){if(g>1)throw TypeError("Generator is already running");for(b&&1===D&&d(D,A),y=D,v=A;(c=y<2?r:v)||!b;){m||(y?y<3?(y>1&&(_.n=-1),d(y,v)):_.n=v:_.v=v);try{if(g=2,m){if(y||(p="next"),c=m[p]){if(!(c=c.call(m,v)))throw TypeError("iterator result is not an object");if(!c.done)return c;v=c.value,y<2&&(y=0)}else 1===y&&(c=m.return)&&c.call(m),y<2&&(v=TypeError("The iterator does not provide a '"+p+"' method"),y=1);m=r}else if((c=(b=_.n<0)?v:l.call(u,_))!==h)break}catch(c){m=r,y=1,v=c}finally{g=1}}return{value:c,done:b}}}(l,p,m),!0),v}var h={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}c=Object.getPrototypeOf;var m=[][u]?c(c([][u]())):(echDnd5e_regeneratorDefine2(c={},u,function(){return this}),c),y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(m);function f(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,GeneratorFunctionPrototype):(r.__proto__=GeneratorFunctionPrototype,echDnd5e_regeneratorDefine2(r,p,"GeneratorFunction")),r.prototype=Object.create(y),r}return GeneratorFunction.prototype=GeneratorFunctionPrototype,echDnd5e_regeneratorDefine2(y,"constructor",GeneratorFunctionPrototype),echDnd5e_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",echDnd5e_regeneratorDefine2(GeneratorFunctionPrototype,p,"GeneratorFunction"),echDnd5e_regeneratorDefine2(y),echDnd5e_regeneratorDefine2(y,p,"Generator"),echDnd5e_regeneratorDefine2(y,u,function(){return this}),echDnd5e_regeneratorDefine2(y,"toString",function(){return"[object Generator]"}),(echDnd5e_regenerator=function _regenerator(){return{w:i,m:f}})()}function echDnd5e_regeneratorDefine2(r,c,l,u){var p=Object.defineProperty;try{p({},"",{})}catch(r){p=0}echDnd5e_regeneratorDefine2=function _regeneratorDefine(r,c,l,u){function o(c,l){echDnd5e_regeneratorDefine2(r,c,function(r){return this._invoke(c,l,r)})}c?p?p(r,c,{value:l,enumerable:!u,configurable:!u,writable:!u}):r[c]=l:(o("next",0),o("throw",1),o("return",2))},echDnd5e_regeneratorDefine2(r,c,l,u)}function echDnd5e_OverloadYield(r,c){this.v=r,this.k=c}function echDnd5e_asyncGeneratorStep(r,c,l,u,p,h,m){try{var y=r[h](m),v=y.value}catch(r){return void l(r)}y.done?c(v):Promise.resolve(v).then(u,p)}function echDnd5e_asyncToGenerator(r){return function(){var c=this,l=arguments;return new Promise(function(u,p){var h=r.apply(c,l);function _next(r){echDnd5e_asyncGeneratorStep(h,u,p,_next,_throw,"next",r)}function _throw(r){echDnd5e_asyncGeneratorStep(h,u,p,_next,_throw,"throw",r)}_next(void 0)})}}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return echDnd5e_arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||echDnd5e_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _createForOfIteratorHelper(r,c){var l="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!l){if(Array.isArray(r)||(l=echDnd5e_unsupportedIterableToArray(r))||c&&r&&"number"==typeof r.length){l&&(r=l);var u=0,p=function F(){};return{s:p,n:function n(){return u>=r.length?{done:!0}:{done:!1,value:r[u++]}},e:function e(r){throw r},f:p}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var h,m=!0,y=!1;return{s:function s(){l=l.call(r)},n:function n(){var r=l.next();return m=r.done,r},e:function e(r){y=!0,h=r},f:function f(){try{m||null==l.return||l.return()}finally{if(y)throw h}}}}function echDnd5e_unsupportedIterableToArray(r,c){if(r){if("string"==typeof r)return echDnd5e_arrayLikeToArray(r,c);var l={}.toString.call(r).slice(8,-1);return"Object"===l&&r.constructor&&(l=r.constructor.name),"Map"===l||"Set"===l?Array.from(r):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?echDnd5e_arrayLikeToArray(r,c):void 0}}function echDnd5e_arrayLikeToArray(r,c){(null==c||c>r.length)&&(c=r.length);for(var l=0,u=Array(c);l<c;l++)u[l]=r[l];return u}function _classCallCheck(r,c){if(!(r instanceof c))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,c){for(var l=0;l<c.length;l++){var u=c[l];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(r,_toPropertyKey(u.key),u)}}function _createClass(r,c,l){return c&&_defineProperties(r.prototype,c),l&&_defineProperties(r,l),Object.defineProperty(r,"prototype",{writable:!1}),r}function _toPropertyKey(r){var c=function _toPrimitive(r,c){if("object"!=echDnd5e_typeof(r)||!r)return r;var l=r[Symbol.toPrimitive];if(void 0!==l){var u=l.call(r,c||"default");if("object"!=echDnd5e_typeof(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===c?String:Number)(r)}(r,"string");return"symbol"==echDnd5e_typeof(c)?c:c+""}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(r,c,l){var u=function _superPropBase(r,c){for(;!{}.hasOwnProperty.call(r,c)&&null!==(r=_getPrototypeOf(r)););return r}(r,c);if(u){var p=Object.getOwnPropertyDescriptor(u,c);return p.get?p.get.call(arguments.length<3?r:l):p.value}},_get.apply(null,arguments)}function _inherits(r,c){if("function"!=typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(c&&c.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),c&&_setPrototypeOf(r,c)}function _setPrototypeOf(r,c){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,c){return r.__proto__=c,r},_setPrototypeOf(r,c)}function _createSuper(r){var c=_isNativeReflectConstruct();return function(){var l,u=_getPrototypeOf(r);if(c){var p=_getPrototypeOf(this).constructor;l=Reflect.construct(u,arguments,p)}else l=u.apply(this,arguments);return function _possibleConstructorReturn(r,c){if(c&&("object"==echDnd5e_typeof(c)||"function"==typeof c))return c;if(void 0!==c)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(r)}(this,l)}}function _isNativeReflectConstruct(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!r})()}function _getPrototypeOf(r){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf(r)}r.d({},{D:()=>u});var c,l={};function setExplodeItemActivities(){c=function getSetting(r){return game.settings.get(u,r)}("explodeItemActivities")}function initConfig(){Hooks.on("updateItem",function(r){r.parent===ui.ARGON._actor&&ui.ARGON.rendered&&ui.ARGON.components.portrait.refresh()}),Hooks.on("argonInit",function(r){var p;if("dnd5e"===game.system.id){!function registerItems(){l[game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.name"),type:"feat",img:"modules/enhancedcombathud/icons/journey.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:1,units:"turn"},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"}},sort:0,flags:{core:{sourceId:"Item.wyQkeuZkttllAFB1"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.name"),type:"feat",img:"modules/enhancedcombathud/icons/armor-upgrade.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:1,units:"round"},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{statusId:{id:"dnd5edodging0000"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.ready.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.ready.name"),type:"feat",img:"modules/enhancedcombathud/icons/clockwork.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.ready.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.hide.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.hide.name"),type:"feat",img:"modules/enhancedcombathud/icons/cloak-dagger.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.hide.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},recharge:{value:null,charged:!1},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{statusId:{id:"dnd5ehiding00000"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.dash.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.dash.name"),type:"feat",img:"modules/enhancedcombathud/icons/walking-boot.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.dash.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.shove.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.shove.name"),type:"feat",img:"modules/enhancedcombathud/icons/shield-bash.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.shove.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:1,width:null,units:"",type:"creature"},range:{value:null,long:null,units:"touch"},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}}}(),setExplodeItemActivities();var h=r.ARGON,m=function(r){_inherits(DND5eTooltip,r);var c=_createSuper(DND5eTooltip);function DND5eTooltip(){return _classCallCheck(this,DND5eTooltip),c.apply(this,arguments)}return _createClass(DND5eTooltip,[{key:"classes",get:function get(){return _get(_getPrototypeOf(DND5eTooltip.prototype),"classes",this).concat(["dnd5e2"])}}]),DND5eTooltip}(h.CORE.Tooltip),y=null===(p=game.modules.get("midi-qol"))||void 0===p?void 0:p.active,v=function getMidiFlag(r){var c,l;return y&&ui.ARGON._actor?null!==(l=(null!==(c=ui.ARGON._actor.getFlag("midi-qol","actions"))&&void 0!==c?c:{})[r])&&void 0!==l&&l?0:1:null},g=function checkActivationType(r,c){var l,u;if(null!==(l=r.activation)&&void 0!==l&&l.type)return c.includes(r.activation.type);if(null!=r&&null!==(u=r.system)&&void 0!==u&&u.activities)for(var p=0,h=Array.from(r.system.activities);p<h.length;p++){var m,y=h[p];if(c.includes(null===(m=y.activation)||void 0===m?void 0:m.type))return!0}},D=function getActivationType(r){var c,l;if(null!=r&&null!==(c=r.system)&&void 0!==c&&c.activities)return null===(l=Array.from(r.system.activities)[0])||void 0===l||null===(l=l.activation)||void 0===l?void 0:l.type},b=function getActionType(r){var c,l;if(null!=r&&null!==(c=r.system)&&void 0!==c&&null!==(c=c.activities)&&void 0!==c&&c.size)return null===(l=Array.from(r.system.activities)[0])||void 0===l?void 0:l.actionType},_={action:["action"],bonus:["bonus"],reaction:["reaction","reactiondamage","reactionmanual"],free:["special"]},A={spell:["spell"],feat:["feat"],consumable:["consumable","equipment","loot"]},w=[];game.settings.get(u,"showWeaponsItems")&&A.consumable.unshift("weapon"),game.settings.get(u,"showClassActions")&&w.push("class"),r.DND5E={actionTypes:_,itemTypes:A,mainBarFeatures:w,ECHItems:l},Hooks.callAll("enhanced-combat-hud.dnd5e.initConfig",{actionTypes:_,itemTypes:A,ECHItems:l});var k=function(r){_inherits(DND5ePortraitPanel,r);var c,l,u=_createSuper(DND5ePortraitPanel);function DND5ePortraitPanel(){_classCallCheck(this,DND5ePortraitPanel);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return u.call.apply(u,[this].concat(c))}return _createClass(DND5ePortraitPanel,[{key:"description",get:function get(){var r=this.actor,c=r.type,l=r.system,u=this.actor,p="character"===c;if("npc"===c){var h,m,y=game.i18n.localize(null!==(h=null===(m=CONFIG.DND5E.creatureTypes[u.system.details.type.value])||void 0===m?void 0:m.label)&&void 0!==h?h:u.system.details.type.custom),v=l.details.cr>=1||l.details.cr<=0?l.details.cr:"1/".concat(1/l.details.cr);return"CR ".concat(v," ").concat(y)}if(p){var g=Object.values(u.classes).map(function(r){return r.name}).join(" / ");return"Level ".concat(l.details.level," ").concat(g," (").concat(l.details.race,")")}return""}},{key:"isDead",get:function get(){return this.isDying&&"character"!==this.actor.type}},{key:"isDying",get:function get(){return this.actor.system.attributes.hp.value<=0}},{key:"successes",get:function get(){var r,c;return null!==(r=null===(c=this.actor.system.attributes)||void 0===c||null===(c=c.death)||void 0===c?void 0:c.success)&&void 0!==r?r:0}},{key:"failures",get:function get(){var r,c;return null!==(r=null===(c=this.actor.system.attributes)||void 0===c||null===(c=c.death)||void 0===c?void 0:c.failure)&&void 0!==r?r:0}},{key:"configurationTemplate",get:function get(){return"modules/enhancedcombathud-dnd5e/templates/argon-actor-config.hbs"}},{key:"_onDeathSave",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee(r){return echDnd5e_regeneratorRuntime().wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:this.actor.rollDeathSave({});case 1:case"end":return r.stop()}},_callee,this)})),function _onDeathSave(r){return l.apply(this,arguments)})},{key:"getStatBlocks",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee2(){var r,c,l,u,p,h,m,y;return echDnd5e_regeneratorRuntime().wrap(function _callee2$(v){for(;;)switch(v.prev=v.next){case 0:return l=game.i18n.localize("DND5E.HitPoints").split(" ").map(function(r){return r.charAt(0).toUpperCase()}).join(""),u=game.i18n.localize("DND5E.ArmorClass").split(" ").map(function(r){return r.charAt(0).toUpperCase()}).join(""),p=game.i18n.localize("DND5E.SaveDC").replace("{ability}","").replace("{dc}","").trim(),h=this.actor.system.attributes.hp.temp?"#6698f3":"rgb(0 255 170)",m=this.actor.system.attributes.hp.tempmax,y=m?m>0?"rgb(222 91 255)":"#ffb000":"rgb(255 255 255)",v.abrupt("return",[[{text:"".concat(this.actor.system.attributes.hp.value+(null!==(r=this.actor.system.attributes.hp.temp)&&void 0!==r?r:0)),color:h},{text:"/"},{text:"".concat(this.actor.system.attributes.hp.max+(null!==(c=this.actor.system.attributes.hp.tempmax)&&void 0!==c?c:0)),color:y},{text:l}],[{text:u},{text:this.actor.system.attributes.ac.value,color:"var(--ech-movement-baseMovement-background)"}],[{text:p},{text:this.actor.system.attributes.spell.dc,color:"var(--ech-movement-baseMovement-background)"}]]);case 7:case"end":return v.stop()}},_callee2,this)})),function getStatBlocks(){return c.apply(this,arguments)})}]),DND5ePortraitPanel}(h.PORTRAIT.PortraitPanel),N=function(r){_inherits(DND5eDrawerButton,r);var c,l=_createSuper(DND5eDrawerButton);function DND5eDrawerButton(r,c,u){var p;return _classCallCheck(this,DND5eDrawerButton),(p=l.call(this,r)).item=c,p.type=u,p}return _createClass(DND5eDrawerButton,[{key:"hasTooltip",get:function get(){return!0}},{key:"getTooltipData",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee3(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee3$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,getTooltipDetails(this.item,this.type);case 2:return r=c.sent,c.abrupt("return",r);case 4:case"end":return c.stop()}},_callee3,this)})),function getTooltipData(){return c.apply(this,arguments)})}]),DND5eDrawerButton}(h.DRAWER.DrawerButton),P=function(r){_inherits(DND5eDrawerPanel,r);var c=_createSuper(DND5eDrawerPanel);function DND5eDrawerPanel(){_classCallCheck(this,DND5eDrawerPanel);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return c.call.apply(c,[this].concat(l))}return _createClass(DND5eDrawerPanel,[{key:"categories",get:function get(){var r=this,c=this.actor.system.abilities,l=this.actor.system.skills,u=this.actor.itemTypes.tool,p=function addSign(r){return r>=0?"+".concat(r):r},h=Object.keys(c).map(function(l){var u=c[l];return new N([{label:CONFIG.DND5E.abilities[l].label,onClick:function onClick(c){return r.actor.rollAbilityCheck({ability:l,event:c})}},{label:p(u.mod+(u.checkBonus||0)),onClick:function onClick(c){return r.actor.rollAbilityCheck({ability:l,event:c})}},{label:p(u.save.value),onClick:function onClick(c){return r.actor.rollSavingThrow({ability:l,event:c})}}],l,"save")}),m=Object.keys(l).map(function(c){var u=l[c];return new N([{label:getProficiencyIcon(u.proficient)+CONFIG.DND5E.skills[c].label,onClick:function onClick(l){return r.actor.rollSkill({skill:c,event:l})}},{label:"".concat(p(u.total),'<span style="margin: 0 1rem; filter: brightness(0.8)">(').concat(u.passive,")</span>"),style:"display: flex; justify-content: flex-end;"}],c,"skill")}),y=u.map(function(l){return new N([{label:getProficiencyIcon(l.system.proficient)+l.name,onClick:function onClick(r){return l.rollToolCheck({event:r})}},{label:p(c[l.abilityMod].mod+l.system.proficiencyMultiplier*r.actor.system.attributes.prof)}],l)});return[{gridCols:"5fr 2fr 2fr",captions:[{label:game.i18n.localize("DND5E.Abilities"),align:"left"},{label:game.i18n.localize("DND5E.CHECK.Title"),align:"center"},{label:game.i18n.localize("DND5E.SAVE.Title.one"),align:"center"}],align:["left","center","center"],buttons:h},{gridCols:"7fr 2fr",captions:[{label:game.i18n.localize("DND5E.Skills")},{label:""}],buttons:m},{gridCols:"7fr 2fr",captions:[{label:game.i18n.localize("enhancedcombathud-dnd5e.hud.tools.name")},{label:""}],buttons:y}]}},{key:"title",get:function get(){return"".concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.saves.name")," / ").concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.skills.name")," / ").concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.tools.name"))}}]),DND5eDrawerPanel}(h.DRAWER.DrawerPanel),C=function(c){_inherits(DND5eActionActionPanel,c);var p,m=_createSuper(DND5eActionActionPanel);function DND5eActionActionPanel(){_classCallCheck(this,DND5eActionActionPanel);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return m.call.apply(m,[this].concat(c))}return _createClass(DND5eActionActionPanel,[{key:"label",get:function get(){return"DND5E.Action"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=v("action"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(p=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee4(){var c,p,m,y,v,b,w,k;return echDnd5e_regeneratorRuntime().wrap(function _callee4$(N){for(;;)switch(N.prev=N.next){case 0:return c=this.actor.items.filter(function(c){var l;return A.spell.includes(c.type)&&_.action.includes(D(c))&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)}),p=expandActivities(this.actor.items.filter(function(c){var l;return A.feat.includes(c.type)&&g(c,_.action)&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)}),_.action),m=expandActivities(this.actor.items.filter(function(c){var l;return A.consumable.includes(c.type)&&g(c,_.action)&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)}),_.action),y=c.length?[new E({type:"spell",items:c,color:0})].filter(function(r){return r.hasContents}):[],v=Object.values(l),b=game.settings.get(u,"showSpecialActions"),w=[],b?w.push.apply(w,[new B({item:null,isWeaponSet:!0,isPrimary:!0}),new h.MAIN.BUTTONS.SplitButton(new G(v[0]),new G(v[1]))].concat(_toConsumableArray(y),[new E({type:"feat",items:p,color:0}),new h.MAIN.BUTTONS.SplitButton(new G(v[2]),new G(v[3])),new h.MAIN.BUTTONS.SplitButton(new G(v[4]),new G(v[5])),new E({type:"consumable",items:m,color:0})])):w.push.apply(w,[new B({item:null,isWeaponSet:!0,isPrimary:!0})].concat(_toConsumableArray(y),[new E({type:"feat",items:p,color:0}),new E({type:"consumable",items:m,color:0})])),k=this.actor.items.filter(function(c){var l;return r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)&&g(c,_.action)}),w.push.apply(w,_toConsumableArray(condenseItemButtons(k))),N.abrupt("return",w.filter(function(r){return r.hasContents||null==r.items||r.items.length}));case 11:case"end":return N.stop()}},_callee4,this)})),function _getButtons(){return p.apply(this,arguments)})}]),DND5eActionActionPanel}(h.MAIN.ActionPanel),O=function(c){_inherits(DND5eBonusActionPanel,c);var l,u=_createSuper(DND5eBonusActionPanel);function DND5eBonusActionPanel(){_classCallCheck(this,DND5eBonusActionPanel);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return u.call.apply(u,[this].concat(c))}return _createClass(DND5eBonusActionPanel,[{key:"label",get:function get(){return"DND5E.BonusAction"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=v("bonus"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee5(){var c,l,u,p,h,m=this;return echDnd5e_regeneratorRuntime().wrap(function _callee5$(y){for(;;)switch(y.prev=y.next){case 0:c=[new B({item:null,isWeaponSet:!0,isPrimary:!1})],l=echDnd5e_regeneratorRuntime().mark(function _loop(){var l,h,y,v,b,A,w,k;return echDnd5e_regeneratorRuntime().wrap(function _loop$(N){for(;;)switch(N.prev=N.next){case 0:if(l=echDnd5e_slicedToArray(p[u],2),h=l[0],y=l[1],(v=m.actor.items.filter(function(c){var l;return y.includes(c.type)&&g(c,_.bonus)&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)})).length){N.next=4;break}return N.abrupt("return","continue");case 4:if("spell"!==h){N.next=9;break}return b=v.filter(function(r){return _.bonus.includes(D(r))}),(A=new E({type:h,items:b,color:1})).hasContents&&c.push(A),N.abrupt("return","continue");case 9:if((w=expandActivities(v,_.bonus)).length){N.next=12;break}return N.abrupt("return","continue");case 12:(k=new E({type:h,items:w,color:1})).hasContents&&c.push(k);case 14:case"end":return N.stop()}},_loop)}),u=0,p=Object.entries(A);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(l(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return h=this.actor.items.filter(function(c){var l;return r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)&&g(c,_.bonus)}),c.push.apply(c,_toConsumableArray(condenseItemButtons(h))),y.abrupt("return",c);case 14:case"end":return y.stop()}},_callee5,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eBonusActionPanel}(h.MAIN.ActionPanel),T=function(c){_inherits(DND5eReactionActionPanel,c);var l,u=_createSuper(DND5eReactionActionPanel);function DND5eReactionActionPanel(){_classCallCheck(this,DND5eReactionActionPanel);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return u.call.apply(u,[this].concat(c))}return _createClass(DND5eReactionActionPanel,[{key:"label",get:function get(){return"DND5E.Reaction"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=v("reaction"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee6(){var c,l,u,p,h,m=this;return echDnd5e_regeneratorRuntime().wrap(function _callee6$(y){for(;;)switch(y.prev=y.next){case 0:c=[new B({item:null,isWeaponSet:!0,isPrimary:!0})],l=echDnd5e_regeneratorRuntime().mark(function _loop2(){var l,h,y,v,b,A,w,k;return echDnd5e_regeneratorRuntime().wrap(function _loop2$(N){for(;;)switch(N.prev=N.next){case 0:if(l=echDnd5e_slicedToArray(p[u],2),h=l[0],y=l[1],(v=m.actor.items.filter(function(c){var l;return y.includes(c.type)&&g(c,_.reaction)&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)})).length){N.next=4;break}return N.abrupt("return","continue");case 4:if("spell"!==h){N.next=9;break}return b=v.filter(function(r){return _.reaction.includes(D(r))}),(A=new E({type:h,items:b,color:1})).hasContents&&c.push(A),N.abrupt("return","continue");case 9:if((w=expandActivities(v,_.reaction)).length){N.next=12;break}return N.abrupt("return","continue");case 12:(k=new E({type:h,items:w,color:3})).hasContents&&c.push(k);case 14:case"end":return N.stop()}},_loop2)}),u=0,p=Object.entries(A);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(l(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return h=this.actor.items.filter(function(c){var l;return r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)&&g(c,_.reaction)}),c.push.apply(c,_toConsumableArray(condenseItemButtons(h))),y.abrupt("return",c);case 14:case"end":return y.stop()}},_callee6,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eReactionActionPanel}(h.MAIN.ActionPanel),x=function(c){_inherits(DND5eFreeActionPanel,c);var l,u=_createSuper(DND5eFreeActionPanel);function DND5eFreeActionPanel(){_classCallCheck(this,DND5eFreeActionPanel);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return u.call.apply(u,[this].concat(c))}return _createClass(DND5eFreeActionPanel,[{key:"label",get:function get(){return"DND5E.Special"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){return this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee7(){var c,l,u,p,h,m=this;return echDnd5e_regeneratorRuntime().wrap(function _callee7$(y){for(;;)switch(y.prev=y.next){case 0:c=[],l=echDnd5e_regeneratorRuntime().mark(function _loop3(){var l,h,y,v,b,A,w,k;return echDnd5e_regeneratorRuntime().wrap(function _loop3$(N){for(;;)switch(N.prev=N.next){case 0:if(l=echDnd5e_slicedToArray(p[u],2),h=l[0],y=l[1],(v=m.actor.items.filter(function(c){var l;return y.includes(c.type)&&g(c,_.free)&&!r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)})).length){N.next=4;break}return N.abrupt("return","continue");case 4:if("spell"!==h){N.next=9;break}return b=v.filter(function(r){return _.free.includes(D(r))}),(A=new E({type:h,items:b,color:1})).hasContents&&c.push(A),N.abrupt("return","continue");case 9:if((w=expandActivities(v,_.free)).length){N.next=12;break}return N.abrupt("return","continue");case 12:(k=new E({type:h,items:w,color:2})).hasContents&&c.push(k);case 14:case"end":return N.stop()}},_loop3)}),u=0,p=Object.entries(A);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(l(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return h=this.actor.items.filter(function(c){var l;return r.DND5E.mainBarFeatures.includes(null===(l=c.system.type)||void 0===l?void 0:l.value)&&g(c,_.free)}),c.push.apply(c,_toConsumableArray(condenseItemButtons(h))),y.abrupt("return",c);case 14:case"end":return y.stop()}},_callee7,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eFreeActionPanel}(h.MAIN.ActionPanel),S=function(r){_inherits(DND5eLegActionPanel,r);var c,l=_createSuper(DND5eLegActionPanel);function DND5eLegActionPanel(){_classCallCheck(this,DND5eLegActionPanel);for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return l.call.apply(l,[this].concat(c))}return _createClass(DND5eLegActionPanel,[{key:"label",get:function get(){return"DND5E.LegendaryAction.Label"}},{key:"maxActions",get:function get(){var r,c,l;return null!==(r=this.actor)&&void 0!==r&&r.inCombat&&null!==(c=null===(l=this.actor.system.resources)||void 0===l||null===(l=l.legact)||void 0===l?void 0:l.max)&&void 0!==c?c:null}},{key:"currentActions",get:function get(){var r,c;return null!==(r=null===(c=this.actor.system.resources)||void 0===c||null===(c=c.legact)||void 0===c?void 0:c.value)&&void 0!==r?r:null}},{key:"_getButtons",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee8(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee8$(c){for(;;)switch(c.prev=c.next){case 0:return r=[],this.actor.items.filter(function(r){return"legendary"===D(r)}).forEach(function(c){r.push(new B({item:c,inActionPanel:!0}))}),c.abrupt("return",r);case 4:case"end":return c.stop()}},_callee8,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eLegActionPanel}(h.MAIN.ActionPanel),R=function(r){_inherits(DND5eLairActionPanel,r);var c,l=_createSuper(DND5eLairActionPanel);function DND5eLairActionPanel(){_classCallCheck(this,DND5eLairActionPanel);for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return l.call.apply(l,[this].concat(c))}return _createClass(DND5eLairActionPanel,[{key:"label",get:function get(){return"DND5E.LAIR.Action.Label"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return 1*(null===(r=this.actor.system.resources.lair)||void 0===r?void 0:r.value)}},{key:"_getButtons",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee9(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee9$(c){for(;;)switch(c.prev=c.next){case 0:return r=[],this.actor.items.filter(function(r){return"lair"===D(r)}).forEach(function(c){r.push(new B({item:c,inActionPanel:!0}))}),c.abrupt("return",r);case 4:case"end":return c.stop()}},_callee9,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eLairActionPanel}(h.MAIN.ActionPanel),I=function(r){_inherits(DND5eMythicActionPanel,r);var c,l=_createSuper(DND5eMythicActionPanel);function DND5eMythicActionPanel(){_classCallCheck(this,DND5eMythicActionPanel);for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return l.call.apply(l,[this].concat(c))}return _createClass(DND5eMythicActionPanel,[{key:"label",get:function get(){return"DND5E.MythicActionLabel"}},{key:"maxActions",get:function get(){return null}},{key:"currentActions",get:function get(){return null}},{key:"_getButtons",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee0(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee0$(c){for(;;)switch(c.prev=c.next){case 0:return r=[],this.actor.items.filter(function(r){return"mythic"===D(r)}).forEach(function(c){r.push(new B({item:c,inActionPanel:!0}))}),c.abrupt("return",r);case 4:case"end":return c.stop()}},_callee0,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eMythicActionPanel}(h.MAIN.ActionPanel),B=function(r){_inherits(DND5eItemButton,r);var c,l,u,p,h=_createSuper(DND5eItemButton);function DND5eItemButton(){_classCallCheck(this,DND5eItemButton);for(var r=arguments.length,c=new Array(r),l=0;l<r;l++)c[l]=arguments[l];return h.call.apply(h,[this].concat(c))}return _createClass(DND5eItemButton,[{key:"item",get:function get(){var r,c;return null!==(r=null===(c=this._item)||void 0===c?void 0:c.item)&&void 0!==r?r:this._item}},{key:"isActivity",get:function get(){var r;return!(null!==(r=this._item)&&void 0!==r&&null!==(r=r.system)&&void 0!==r&&r.activities)}},{key:"activity",get:function get(){return this.isActivity?this._item:Array.from(this._item.system.activities)[0]}},{key:"hasTooltip",get:function get(){return!0}},{key:"ranges",get:function get(){var r,c,l,u,p,h=this.activity,m="touch"==h.range.units?null===(r=canvas)||void 0===r||null===(r=r.scene)||void 0===r||null===(r=r.grid)||void 0===r?void 0:r.distance:null;return{normal:null!==(c=null==h||null===(l=h.range)||void 0===l?void 0:l.value)&&void 0!==c?c:m,long:null!==(u=null==h||null===(p=h.range)||void 0===p?void 0:p.long)&&void 0!==u?u:null}}},{key:"label",get:function get(){return this.isActivity?this.activity.name+" (".concat(this.item.name,")"):_get(_getPrototypeOf(DND5eItemButton.prototype),"label",this)}},{key:"targets",get:function get(){var r,c,l,u,p=this.activity,h=["creature","ally","enemy"],m=p.actionType,y=null!==(r=null===(c=p.target)||void 0===c?void 0:c.affects)&&void 0!==r?r:{},v=y.type;return null!==(l=p.target)&&void 0!==l&&null!==(l=l.template)&&void 0!==l&&l.units||!h.includes(v)?h.includes(v)&&y.count?y.count:"mwak"===m||"rwak"===m||"msak"===m||"rsak"===m?y.count||1:null:null!==(u=y.count)&&void 0!==u?u:1}},{key:"visible",get:function get(){var r,c;if(!this._isWeaponSet)return _get(_getPrototypeOf(DND5eItemButton.prototype),"visible",this);var l=this.parent instanceof T,u="mwak"===(null===(r=this.activity)||void 0===r?void 0:r.actionType);return!(l&&!u)&&((this._isPrimary||"shield"!==(null===(c=this.activity)||void 0===c||null===(c=c.type)||void 0===c?void 0:c.value))&&_get(_getPrototypeOf(DND5eItemButton.prototype),"visible",this))}},{key:"getTooltipData",value:(p=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee1(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee1$(c){for(;;)switch(c.prev=c.next){case 0:if(!this.isActivity){c.next=6;break}return c.next=3,getTooltipDetails(_objectSpread(_objectSpread(_objectSpread({},this.item),this.activity),{},{name:this.label}));case 3:c.t0=c.sent,c.next=9;break;case 6:return c.next=8,getTooltipDetails(this.item);case 8:c.t0=c.sent;case 9:return(r=c.t0).propertiesLabel="enhancedcombathud-dnd5e.tooltip.properties.name",c.abrupt("return",r);case 12:case"end":return c.stop()}},_callee1,this)})),function getTooltipData(){return p.apply(this,arguments)})},{key:"_onLeftClick",value:(u=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee10(r){var c,l,u,p;return echDnd5e_regeneratorRuntime().wrap(function _callee10$(h){for(;;)switch(h.prev=h.next){case 0:if(this.isActivity){h.next=2;break}return h.abrupt("return",this.item.use({event:r,legacy:!1},{event:r}));case 2:return h.next=4,this.activity.use({event:r,legacy:!1},{event:r});case 4:h.sent&&(DND5eItemButton.consumeActionEconomy(this.activity),(l=null===(c=this.activity)||void 0===c||null===(c=c.consumption)||void 0===c||null===(c=c.targets)||void 0===c?void 0:c.find(function(r){return"itemUses"===r.type}))&&(u=this.actor.items.get(l.target),p=this.actor.items.filter(function(r){var c;return null===(c=r.system.activities)||void 0===c?void 0:c.find(function(r){var c;return null===(c=r.consumption)||void 0===c||null===(c=c.targets)||void 0===c?void 0:c.find(function(r){return"itemUses"===r.type&&r.target===u.id})})}),ui.ARGON.updateItemButtons(p)),this.render(!0));case 6:case"end":return h.stop()}},_callee10,this)})),function _onLeftClick(r){return u.apply(this,arguments)})},{key:"_onRightClick",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee11(r){var c,l;return echDnd5e_regeneratorRuntime().wrap(function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:if(this.isActivity){r.next=2;break}return r.abrupt("return",null===(c=this.item)||void 0===c||null===(c=c.sheet)||void 0===c?void 0:c.render(!0));case 2:null===(l=this.activity)||void 0===l||null===(l=l.sheet)||void 0===l||l.render(!0);case 3:case"end":return r.stop()}},_callee11,this)})),function _onRightClick(r){return l.apply(this,arguments)})},{key:"render",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee12(){var r,c,l,u,p,h=this,m=arguments;return echDnd5e_regeneratorRuntime().wrap(function _callee12$(y){for(;;)switch(y.prev=y.next){case 0:for(c=m.length,l=new Array(c),u=0;u<c;u++)l[u]=m[u];return y.next=3,(r=_get(_getPrototypeOf(DND5eItemButton.prototype),"render",this)).call.apply(r,[this].concat(l));case 3:this.activity&&(p=this.actor.items.filter(function(r){var c;return(null===(c=r.consume)||void 0===c?void 0:c.target)===h.activity.id}),ui.ARGON.updateItemButtons(p));case 4:case"end":return y.stop()}},_callee12,this)})),function render(){return c.apply(this,arguments)})},{key:"quantity",get:function get(){var r,c,l,u;if(!this.item)return null;if(null!==(r=this.item.system.uses)&&void 0!==r&&r.max)return this.item.system.uses.max-this.item.system.uses.spent;if(!this.activity)return null;var p=null===(c=this.activity)||void 0===c||null===(c=c.consume)||void 0===c?void 0:c.type,h=null===(l=this.item.system.ammunition)||void 0===l?void 0:l.type,m=null===(u=this.activity)||void 0===u||null===(u=u.consumption)||void 0===u||null===(u=u.targets)||void 0===u?void 0:u.find(function(r){return"itemUses"===r.type});if(m){var y,v=this.actor.items.get(m.target);if(v&&null!==(y=v.system.uses)&&void 0!==y&&y.max)return v.system.uses.max-v.system.uses.spent}if(h){var g,D,b=null===(g=this.item.system.ammunitionOptions[0])||void 0===g?void 0:g.item;return b?Math.floor(null!==(D=b.system.quantity)&&void 0!==D?D:0):null}if("attribute"===p)return Math.floor(getProperty(this.actor,this.activity.consume.target)/this.activity.consume.amount);if("charges"===p){var _,A,w=this.actor.items.get(this.activity.consume.target);return w?Math.floor((null!==(_=null===(A=w.uses)||void 0===A?void 0:A.value)&&void 0!==_?_:0)/this.activity.consume.amount):null}return["consumable"].includes(this.item.type)&&!this.activity.uses.max?this.item.system.quantity:null!==this.activity.uses.value&&null!==this.activity.uses.per&&this.activity.uses.max?this.activity.uses.value:null}}],[{key:"consumeActionEconomy",value:function consumeActionEconomy(r){for(var c,l,u=null==r||null===(c=r.activation)||void 0===c?void 0:c.type,p=null,h=0,m=Object.entries(_);h<m.length;h++){var y=echDnd5e_slicedToArray(m[h],2),v=y[0];y[1].includes(u)&&(p=v)}p&&((null===(l=game.combat)||void 0===l||null===(l=l.combatant)||void 0===l?void 0:l.actor)!==r.item.parent&&(p="reaction"),"action"===p?(ui.ARGON.components.main[0].isActionUsed=!0,ui.ARGON.components.main[0].updateActionUse()):"bonus"===p?(ui.ARGON.components.main[1].isActionUsed=!0,ui.ARGON.components.main[1].updateActionUse()):"reaction"===p?(ui.ARGON.components.main[2].isActionUsed=!0,ui.ARGON.components.main[2].updateActionUse()):"free"===p?(ui.ARGON.components.main[3].isActionUsed=!0,ui.ARGON.components.main[3].updateActionUse()):"legendary"===p&&(ui.ARGON.components.main[4].isActionUsed=!0))}}]),DND5eItemButton}(h.MAIN.BUTTONS.ItemButton),E=function(r){_inherits(DND5eButtonPanelButton,r);var c,l=_createSuper(DND5eButtonPanelButton);function DND5eButtonPanelButton(r){var c,u=r.type,p=r.items,h=r.color;return _classCallCheck(this,DND5eButtonPanelButton),(c=l.call(this)).type=u,c.items=p,c.color=h,c.itemsWithSpells=[],c._spells=c.prePrepareSpells(),c}return _createClass(DND5eButtonPanelButton,[{key:"hasContents",get:function get(){return this._spells?!!this._spells.length||!!this.itemsWithSpells.length:!!this.items.length}},{key:"colorScheme",get:function get(){return this.color}},{key:"id",get:function get(){return"".concat(this.type,"-").concat(this.color)}},{key:"label",get:function get(){switch(this.type){case"spell":return"enhancedcombathud-dnd5e.hud.castspell.name";case"feat":return"enhancedcombathud-dnd5e.hud.usepower.name";case"consumable":case"weapon":return"enhancedcombathud-dnd5e.hud.useitem.name"}}},{key:"icon",get:function get(){switch(this.type){case"spell":return"modules/enhancedcombathud/icons/spell-book.webp";case"feat":return"modules/enhancedcombathud/icons/mighty-force.webp";case"consumable":case"weapon":return"modules/enhancedcombathud/icons/drink-me.webp"}}},{key:"showPreparedOnly",get:function get(){if("character"!==this.actor.type)return!1;var r=this.actor.getFlag(u,"showPrepared");if("all"===r)return!1;if("preparedOnly"===r)return!0;var c=Object.keys(this.actor.classes);return["cleric","druid","paladin","wizard","artificer"].some(function(r){return c.includes(r)})}},{key:"prePrepareSpells",value:function prePrepareSpells(){var r=this;if("spell"===this.type){var c=CONFIG.DND5E.spellLevels,l=[],u=new Map;this.items.filter(function(r){var c;return null===(c=r.flags.dnd5e)||void 0===c?void 0:c.cachedFor}).forEach(function(c){var p=fromUuidSync(r.actor.documentName+"."+r.actor.id+c.flags.dnd5e.cachedFor);if(l.push(c),null!=p&&p.displayInSpellbook){var h=p.item,m=u.get(h);m?m.push(c):u.set(h,[c])}});var p,h=_createForOfIteratorHelper(u);try{var m=function _loop5(){var c=echDnd5e_slicedToArray(p.value,2),l=c[0],u=c[1];r.itemsWithSpells.push({label:l.name,buttons:u.map(function(r){return new B({item:r})}),uses:function uses(){var r,c;return{max:null===(r=l.system)||void 0===r||null===(r=r.uses)||void 0===r?void 0:r.max,value:null===(c=l.system)||void 0===c||null===(c=c.uses)||void 0===c?void 0:c.value}}})};for(h.s();!(p=h.n()).done;)m()}catch(r){h.e(r)}finally{h.f()}if(this.items=this.items.filter(function(r){return!l.includes(r)}),this.showPreparedOnly){var y=["atwill","innate","pact"];this.items=this.items.filter(function(r){var c,l,u;return!!y.includes(null===(c=r.system)||void 0===c?void 0:c.method)||(0==(null===(l=r.system)||void 0===l?void 0:l.level)||(null===(u=r.system)||void 0===u?void 0:u.prepared)>0)})}for(var v=[].concat(_toConsumableArray(this.itemsWithSpells),[{label:"DND5E.SpellPrepAtWill",buttons:this.items.filter(function(r){var c;return"atwill"===(null===(c=r.system)||void 0===c?void 0:c.method)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:"DND5E.SpellPrepInnate",buttons:this.items.filter(function(r){var c;return"innate"===(null===(c=r.system)||void 0===c?void 0:c.method)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:Object.values(c)[0],buttons:this.items.filter(function(r){var c;return 0==(null===(c=r.system)||void 0===c?void 0:c.level)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:"DND5E.PactMagic",buttons:this.items.filter(function(r){var c;return"pact"===(null===(c=r.system)||void 0===c?void 0:c.method)}).map(function(r){return new B({item:r})}),uses:function uses(){return r.actor.system.spells.pact}}]),g=function _loop4(){var c=echDnd5e_slicedToArray(b[D],2),l=c[0],u=c[1],p=r.items.filter(function(r){var c,u;return(null===(c=r.system)||void 0===c?void 0:c.level)==l&&"spell"===(null===(u=r.system)||void 0===u?void 0:u.method)});if(!p.length||0==l)return"continue";v.push({label:u,buttons:p.map(function(r){return new B({item:r})}),uses:function uses(){return r.actor.system.spells["spell".concat(l)]}})},D=0,b=Object.entries(c);D<b.length;D++)g();return v.filter(function(r){return r.buttons.length})}}},{key:"_getPanel",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee13(){return echDnd5e_regeneratorRuntime().wrap(function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:if("spell"!==this.type){r.next=4;break}return r.abrupt("return",new h.MAIN.BUTTON_PANELS.ACCORDION.AccordionPanel({id:this.id,accordionPanelCategories:this._spells.map(function(r){var c=r.label,l=r.buttons,u=r.uses;return new h.MAIN.BUTTON_PANELS.ACCORDION.AccordionPanelCategory({label:c,buttons:l,uses:u})})}));case 4:return r.abrupt("return",new h.MAIN.BUTTON_PANELS.ButtonPanel({id:this.id,buttons:this.items.map(function(r){return new B({item:r})})}));case 5:case"end":return r.stop()}},_callee13,this)})),function _getPanel(){return c.apply(this,arguments)})}]),DND5eButtonPanelButton}(h.MAIN.BUTTONS.ButtonPanelButton),G=function(r){_inherits(DND5eSpecialActionButton,r);var c,l,u,p=_createSuper(DND5eSpecialActionButton);function DND5eSpecialActionButton(r){var c,l;_classCallCheck(this,DND5eSpecialActionButton);var u=(l=p.call(this)).actor.items.getName(r.name);return l.actorItem=u,l.statusId=null===(c=r.flags)||void 0===c||null===(c=c.statusId)||void 0===c?void 0:c.id,l.item=null!=u?u:new CONFIG.Item.documentClass(r,{parent:l.actor}),l}return _createClass(DND5eSpecialActionButton,[{key:"label",get:function get(){return this.item.name}},{key:"icon",get:function get(){return this.item.img}},{key:"hasTooltip",get:function get(){return!0}},{key:"activity",get:function get(){var r;if(null!==(r=this.item)&&void 0!==r&&null!==(r=r.system)&&void 0!==r&&r.activities)return Array.from(this.item.system.activities)[0]}},{key:"getTooltipData",value:(u=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee14(){var r;return echDnd5e_regeneratorRuntime().wrap(function _callee14$(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,getTooltipDetails(this.item);case 2:return(r=c.sent).propertiesLabel="enhancedcombathud-dnd5e.tooltip.properties.name",c.abrupt("return",r);case 5:case"end":return c.stop()}},_callee14,this)})),function getTooltipData(){return u.apply(this,arguments)})},{key:"_onLeftClick",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee15(r){var c,l,u,p,h=this;return echDnd5e_regeneratorRuntime().wrap(function _callee15$(m){for(;;)switch(m.prev=m.next){case 0:if(l=(null===(c=game.modules.get("dfreds-convenient-effects"))||void 0===c?void 0:c.active)&&game.dfreds.effectInterface.findEffect({effectName:this.label}),u=!1,!l){m.next=8;break}return u=!0,m.next=6,game.dfreds.effectInterface.toggleEffect({effectName:this.label,overlay:!1,uuids:[this.actor.uuid]});case 6:m.next=19;break;case 8:if(!this.actorItem){m.next=14;break}return m.next=11,this.activity.use({event:r},{event:r});case 11:m.t0=m.sent,m.next=17;break;case 14:return m.next=16,this.createChatMessage();case 16:m.t0=m.sent;case 17:u=m.t0,this.statusId&&(p=CONFIG.statusEffects.find(function(r){return r._id===h.statusId}))&&this.actor.toggleStatusEffect(p.id);case 19:u&&B.consumeActionEconomy(this.item);case 20:case"end":return m.stop()}},_callee15,this)})),function _onLeftClick(r){return l.apply(this,arguments)})},{key:"createChatMessage",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee16(){return echDnd5e_regeneratorRuntime().wrap(function _callee16$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ChatMessage.create({user:game.user,speaker:{actor:this.actor,token:this.actor.token,alias:this.actor.name},content:'\n                    <div class="dnd5e2 chat-card item-card" data-display-challenge="">\n\n    <section class="card-header description collapsible">\n\n        <header class="summary">\n            <img class="gold-icon" src="'.concat(this.icon,'">\n            <div class="name-stacked border">\n                <span class="title">').concat(this.label,'</span>\n                <span class="subtitle">\n                    Feature\n                </span>\n            </div>\n            <i class="fas fa-chevron-down fa-fw"></i>\n        </header>\n\n        <section class="details collapsible-content card-content">\n            <div class="wrapper">\n                ').concat(this.item.system.description.value,"\n            </div>\n        </section>\n    </section>\n\n\n</div>\n                    ")});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},_callee16,this)})),function createChatMessage(){return c.apply(this,arguments)})}]),DND5eSpecialActionButton}(h.MAIN.BUTTONS.ActionButton),j=function(r){_inherits(DND5eMovementHud,r);var c=_createSuper(DND5eMovementHud);function DND5eMovementHud(){return _classCallCheck(this,DND5eMovementHud),c.apply(this,arguments)}return _createClass(DND5eMovementHud,[{key:"movementMax",get:function get(){return this.actor&&this.actor.system.attributes.movement[this.movementMode]?this.actor.system.attributes.movement[this.movementMode]/canvas.scene.dimensions.distance:0}}]),DND5eMovementHud}(h.MovementHud),M=function(r){_inherits(DND5eButtonHud,r);var c,l=_createSuper(DND5eButtonHud);function DND5eButtonHud(){_classCallCheck(this,DND5eButtonHud);for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return l.call.apply(l,[this].concat(c))}return _createClass(DND5eButtonHud,[{key:"visible",get:function get(){var r;return!(null!==(r=game.combat)&&void 0!==r&&r.started)}},{key:"_getButtons",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee17(){var r=this;return echDnd5e_regeneratorRuntime().wrap(function _callee17$(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",[{label:"DND5E.REST.Long.Label",onClick:function onClick(c){return r.actor.longRest()},icon:"fas fa-bed"},{label:"DND5E.REST.Short.Label",onClick:function onClick(c){return r.actor.shortRest()},icon:"fas fa-coffee"}]);case 1:case"end":return c.stop()}},_callee17)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eButtonHud}(h.ButtonHud),z=function(r){_inherits(DND5eWeaponSets,r);var c,l,u,p=_createSuper(DND5eWeaponSets);function DND5eWeaponSets(){return _classCallCheck(this,DND5eWeaponSets),p.apply(this,arguments)}return _createClass(DND5eWeaponSets,[{key:"getDefaultSets",value:(u=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee18(){var r,c,l,u,p,h,m,y,v,g,b,_,A,w,k,N,P;return echDnd5e_regeneratorRuntime().wrap(function _callee18$(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,_get(_getPrototypeOf(DND5eWeaponSets.prototype),"getDefaultSets",this).call(this);case 2:if(w=C.sent,k=null===(r=this.actor.flags)||void 0===r||null===(r=r.dnd5e)||void 0===r?void 0:r.isPolymorphed,"npc"===this.actor.type||k){C.next=6;break}return C.abrupt("return",w);case 6:return N=this.actor.items.filter(function(r){return"weapon"===r.type&&"action"===D(r)}),P=this.actor.items.filter(function(r){return"weapon"===r.type&&"bonus"===D(r)}),C.abrupt("return",{1:{primary:null!==(c=null===(l=N[0])||void 0===l?void 0:l.uuid)&&void 0!==c?c:null,secondary:null!==(u=null===(p=P[0])||void 0===p?void 0:p.uuid)&&void 0!==u?u:null},2:{primary:null!==(h=null===(m=N[1])||void 0===m?void 0:m.uuid)&&void 0!==h?h:null,secondary:null!==(y=null===(v=P[1])||void 0===v?void 0:v.uuid)&&void 0!==y?y:null},3:{primary:null!==(g=null===(b=N[2])||void 0===b?void 0:b.uuid)&&void 0!==g?g:null,secondary:null!==(_=null===(A=P[2])||void 0===A?void 0:A.uuid)&&void 0!==_?_:null}});case 9:case"end":return C.stop()}},_callee18,this)})),function getDefaultSets(){return u.apply(this,arguments)})},{key:"_getSets",value:(l=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee19(){var r,c,l,u,p,h;return echDnd5e_regeneratorRuntime().wrap(function _callee19$(m){for(;;)switch(m.prev=m.next){case 0:if(!(null===(r=this.actor.flags)||void 0===r||null===(r=r.dnd5e)||void 0===r?void 0:r.isPolymorphed)){m.next=7;break}return m.next=4,this.getDefaultSets();case 4:m.t0=m.sent,m.next=13;break;case 7:return m.t1=foundry.utils,m.next=10,this.getDefaultSets();case 10:m.t2=m.sent,m.t3=foundry.utils.deepClone(this.actor.getFlag("enhancedcombathud","weaponSets")||{}),m.t0=m.t1.mergeObject.call(m.t1,m.t2,m.t3);case 13:c=m.t0,l=0,u=Object.entries(c);case 15:if(!(l<u.length)){m.next=36;break}if((p=echDnd5e_slicedToArray(u[l],2))[0],!(h=p[1]).primary){m.next=23;break}return m.next=20,fromUuid(h.primary);case 20:m.t4=m.sent,m.next=24;break;case 23:m.t4=null;case 24:if(h.primary=m.t4,!h.secondary){m.next=31;break}return m.next=28,fromUuid(h.secondary);case 28:m.t5=m.sent,m.next=32;break;case 31:m.t5=null;case 32:h.secondary=m.t5;case 33:l++,m.next=15;break;case 36:return m.abrupt("return",c);case 37:case"end":return m.stop()}},_callee19,this)})),function _getSets(){return l.apply(this,arguments)})},{key:"_onSetChange",value:(c=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee20(r){var c,l,u,p,h,m,y;return echDnd5e_regeneratorRuntime().wrap(function _callee20$(v){for(;;)switch(v.prev=v.next){case 0:if(c=r.sets,l=r.active,game.settings.get("enhancedcombathud-dnd5e","switchEquip")){v.next=4;break}return v.abrupt("return");case 4:return u=[],p=c[l],h=Object.values(p).filter(function(r){return r}),m=Object.values(c).filter(function(r){return r!==p}),y=m.flatMap(function(r){return Object.values(r)}).filter(function(r){return r}).filter(function(r){return!h.includes(r)}),h.forEach(function(r){var c;null!==(c=r.system)&&void 0!==c&&c.equipped||u.push({_id:r.id,"system.equipped":!0})}),y.forEach(function(r){var c;null!==(c=r.system)&&void 0!==c&&c.equipped&&u.push({_id:r.id,"system.equipped":!1})}),v.next=13,this.actor.updateEmbeddedDocuments("Item",u);case 13:return v.abrupt("return",v.sent);case 14:case"end":return v.stop()}},_callee20,this)})),function _onSetChange(r){return c.apply(this,arguments)})}]),DND5eWeaponSets}(h.WeaponSets),U=game.settings.get(u,"macroPanel"),L=[C,O,T,x,S,R,I];U&&L.push(h.PREFAB.MacroPanel),L.push(h.PREFAB.PassTurnPanel),r.definePortraitPanel(k),r.defineDrawerPanel(P),r.defineMainPanels(L),r.defineMovementHud(j),r.defineButtonHud(M),r.defineWeaponSets(z),r.defineTooltip(m),r.defineSupportedActorTypes(["character","npc"])}function expandItemIntoActivities(r){return"never"!==c&&("always"===c||("only-weapons"===c?"weapon"===r.type:void 0))}function expandActivities(r,c){var l,u=[],p=[],h=_createForOfIteratorHelper(r);try{for(h.s();!(l=h.n()).done;){var m=l.value;expandItemIntoActivities(m)?p.push(Array.from(m.system.activities).filter(function(r){return g(r,c)&&"cast"!==r.type})):u.push(m)}}catch(r){h.e(r)}finally{h.f()}var y=[].concat(u,_toConsumableArray(p.flat())),v=y.filter(function(r){var c;return"weapon"===(null!==(c=r.item)&&void 0!==c?c:r).type}),D=y.filter(function(r){var c;return"weapon"!==(null!==(c=r.item)&&void 0!==c?c:r).type});return[].concat(_toConsumableArray(v),_toConsumableArray(D))}function getTooltipDetails(r,c){return _getTooltipDetails.apply(this,arguments)}function _getTooltipDetails(){return(_getTooltipDetails=echDnd5e_asyncToGenerator(echDnd5e_regeneratorRuntime().mark(function _callee21(r,c){var l,u,p,h,m,y,v,g,D,_,A,w,k,N,P,C,O,T,x,S,R,I,B,E,G,j,M,z,U,L,H;return echDnd5e_regeneratorRuntime().wrap(function _callee21$(q){for(;;)switch(q.prev=q.next){case 0:if(w=[],k=[],N="","skill"!=c){q.next=8;break}m=CONFIG.DND5E.skills[r].label,y=game.i18n.localize("enhancedcombathud-dnd5e.skills.".concat(r,".tooltip")),q.next=48;break;case 8:if("save"!=c){q.next=13;break}m=CONFIG.DND5E.abilities[r].label,y=game.i18n.localize("enhancedcombathud-dnd5e.abilities.".concat(r,".tooltip")),q.next=48;break;case 13:if(r&&r.system){q.next=15;break}return q.abrupt("return");case 15:m=r.name,y=r.system.identified?r.system.description.value:null!==(P=r.system.description.unidentified)&&void 0!==P?P:r.system.description.value,v=r.type,D=(null===(C=r.labels)||void 0===C?void 0:C.target)||"-",_=(null===(O=r.labels)||void 0===O?void 0:O.range)||"-",k=[],A=null==r||null===(T=r.labels)||void 0===T||null===(T=T.damages)||void 0===T?void 0:T.map(function(r){return r.damageType}),w=A&&A.length?A:[],N="",q.t0=v,q.next="weapon"===q.t0?27:"spell"===q.t0?32:"consumable"===q.t0?40:"feat"===q.t0?44:48;break;case 27:for(g=CONFIG.DND5E.weaponTypes[r.system.weaponType],(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),S=0,R=Object.entries(r.system.properties);S<R.length;S++)I=echDnd5e_slicedToArray(R[S],2),B=I[0],E=I[1],(G=E&&CONFIG.DND5E.weaponProperties[B]?CONFIG.DND5E.weaponProperties[B]:void 0)&&k.push(G);return q.abrupt("break",48);case 32:g="".concat(r.labels.level," ").concat(r.labels.school),k.push(CONFIG.DND5E.spellSchools[r.system.school]),k.push(r.labels.duration),k.push(r.labels.save),j=_createForOfIteratorHelper(r.labels.components.all);try{for(j.s();!(M=j.n()).done;)z=M.value,k.push(z.abbr)}catch(r){j.e(r)}finally{j.f()}return r.labels.materials&&(N=r.labels.materials),q.abrupt("break",48);case 40:return g=CONFIG.DND5E.consumableTypes[r.system.consumableType],(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),q.abrupt("break",48);case 44:return g=r.system.requirements,(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),q.abrupt("break",48);case 48:if(!y){q.next=52;break}return q.next=51,foundry.applications.ux.TextEditor.implementation.enrichHTML(y,{async:!0,relativeTo:r});case 51:y=q.sent;case 52:return U=[],(D||_)&&(U=[{label:"enhancedcombathud-dnd5e.tooltip.target.name",value:D},{label:"enhancedcombathud-dnd5e.tooltip.range.name",value:_}]),null!=r&&null!==(l=r.labels)&&void 0!==l&&l.toHit&&U.push({label:"enhancedcombathud-dnd5e.tooltip.toHit.name",value:r.labels.toHit}),null!=r&&null!==(u=r.labels)&&void 0!==u&&null!==(u=u.damages)&&void 0!==u&&u.length&&(L="",r.labels.damages.forEach(function(r){L+=r.formula+" "+getDamageTypeIcon(r.damageType)+" "}),U.push({label:"enhancedcombathud-dnd5e.tooltip.damage.name",value:L})),H=[],null!==(p=w)&&void 0!==p&&p.length&&w.forEach(function(r){return H.push({label:r,primary:!0})}),null!==(h=k)&&void 0!==h&&h.length&&k.forEach(function(r){var c;return H.push({label:null!==(c=null==r?void 0:r.label)&&void 0!==c?c:r,secondary:!0})}),q.abrupt("return",{title:m,description:y,subtitle:g,details:U,properties:H,footerText:N});case 60:case"end":return q.stop()}},_callee21)}))).apply(this,arguments)}function getDamageTypeIcon(r){var c;switch(null!==(c=r)&&void 0!==c||(r=""),r.toLowerCase()){case"acid":return'<i class="fas fa-flask"></i>';case"bludgeoning":return'<i class="fas fa-hammer"></i>';case"cold":return'<i class="fas fa-snowflake"></i>';case"fire":return'<i class="fas fa-fire"></i>';case"force":return'<i class="fas fa-hand-sparkles"></i>';case"lightning":return'<i class="fas fa-bolt"></i>';case"necrotic":return'<i class="fas fa-skull"></i>';case"piercing":return'<i class="fas fa-crosshairs"></i>';case"poison":return'<i class="fas fa-skull-crossbones"></i>';case"psychic":return'<i class="fas fa-brain"></i>';case"radiant":return'<i class="fas fa-sun"></i>';case"slashing":return'<i class="fas fa-cut"></i>';case"thunder":return'<i class="fas fa-bell"></i>';case"healing":return'<i class="fas fa-heart"></i>';default:return'<i class="fas fa-sparkles"></i>'}}function getProficiencyIcon(r){return 0==r?'<i style="margin-right: 1ch; pointer-events: none" class="far fa-circle"> </i>':1==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-check"> </i>':2==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-check-double"> </i>':.5==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-adjust"> </i>':'<i style="margin-right: 1ch; pointer-events: none" class="far fa-circle"> </i>'}function condenseItemButtons(r){if(!game.settings.get(u,"condenseClassActions"))return r.map(function(r){return new B({item:r,inActionPanel:!0})});for(var c=[],l=r.length,p=l-l%2,m=null,y=0;y<l;y++){var v=y<p,g=r[y];if(v)if(m){var D=new B({item:g,inActionPanel:!1});c.push(new h.MAIN.BUTTONS.SplitButton(m,D)),m=null}else m=new B({item:g,inActionPanel:!1});else c.push(new B({item:g,inActionPanel:!0}))}return c}})}var u="enhancedcombathud-dnd5e";Hooks.on("setup",function(){registerSettings(),initConfig()})})();
//# sourceMappingURL=index.js.map
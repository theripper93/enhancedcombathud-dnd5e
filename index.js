/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var r={d:(l,c)=>{for(var u in c)r.o(c,u)&&!r.o(l,u)&&Object.defineProperty(l,u,{enumerable:!0,get:c[u]})},o:(r,l)=>Object.prototype.hasOwnProperty.call(r,l)};function _typeof(r){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},_typeof(r)}function _createForOfIteratorHelper(r,l){var c="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!c){if(Array.isArray(r)||(c=_unsupportedIterableToArray(r))||l&&r&&"number"==typeof r.length){c&&(r=c);var u=0,p=function F(){};return{s:p,n:function n(){return u>=r.length?{done:!0}:{done:!1,value:r[u++]}},e:function e(r){throw r},f:p}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var m,h=!0,y=!1;return{s:function s(){c=c.call(r)},n:function n(){var r=c.next();return h=r.done,r},e:function e(r){y=!0,m=r},f:function f(){try{h||null==c.return||c.return()}finally{if(y)throw m}}}}function ownKeys(r,l){var c=Object.keys(r);if(Object.getOwnPropertySymbols){var u=Object.getOwnPropertySymbols(r);l&&(u=u.filter(function(l){return Object.getOwnPropertyDescriptor(r,l).enumerable})),c.push.apply(c,u)}return c}function _objectSpread(r){for(var l=1;l<arguments.length;l++){var c=null!=arguments[l]?arguments[l]:{};l%2?ownKeys(Object(c),!0).forEach(function(l){_defineProperty(r,l,c[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):ownKeys(Object(c)).forEach(function(l){Object.defineProperty(r,l,Object.getOwnPropertyDescriptor(c,l))})}return r}function _defineProperty(r,l,c){return(l=_toPropertyKey(l))in r?Object.defineProperty(r,l,{value:c,enumerable:!0,configurable:!0,writable:!0}):r[l]=c,r}function _slicedToArray(r,l){return function _arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function _iterableToArrayLimit(r,l){var c=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=c){var u,p,m,h,y=[],v=!0,g=!1;try{if(m=(c=c.call(r)).next,0===l){if(Object(c)!==c)return;v=!1}else for(;!(v=(u=m.call(c)).done)&&(y.push(u.value),y.length!==l);v=!0);}catch(r){g=!0,p=r}finally{try{if(!v&&null!=c.return&&(h=c.return(),Object(h)!==h))return}finally{if(g)throw p}}return y}}(r,l)||_unsupportedIterableToArray(r,l)||function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _toConsumableArray(r){return function _arrayWithoutHoles(r){if(Array.isArray(r))return _arrayLikeToArray(r)}(r)||function _iterableToArray(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||_unsupportedIterableToArray(r)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _unsupportedIterableToArray(r,l){if(r){if("string"==typeof r)return _arrayLikeToArray(r,l);var c={}.toString.call(r).slice(8,-1);return"Object"===c&&r.constructor&&(c=r.constructor.name),"Map"===c||"Set"===c?Array.from(r):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?_arrayLikeToArray(r,l):void 0}}function _arrayLikeToArray(r,l){(null==l||l>r.length)&&(l=r.length);for(var c=0,u=Array(l);c<l;c++)u[c]=r[c];return u}function _regeneratorRuntime(){var r=_regenerator(),l=r.m(_regeneratorRuntime),c=(Object.getPrototypeOf?Object.getPrototypeOf(l):l.__proto__).constructor;function n(r){var l="function"==typeof r&&r.constructor;return!!l&&(l===c||"GeneratorFunction"===(l.displayName||l.name))}var u={throw:1,return:2,break:3,continue:3};function a(r){var l,c;return function(p){l||(l={stop:function stop(){return c(p.a,2)},catch:function _catch(){return p.v},abrupt:function abrupt(r,l){return c(p.a,u[r],l)},delegateYield:function delegateYield(r,u,m){return l.resultName=u,c(p.d,_regeneratorValues(r),m)},finish:function finish(r){return c(p.f,r)}},c=function t(r,c,u){p.p=l.prev,p.n=l.next;try{return r(c,u)}finally{l.next=p.n}}),l.resultName&&(l[l.resultName]=p.v,l.resultName=void 0),l.sent=p.v,l.next=p.n;try{return r.call(this,l)}finally{p.p=l.prev,p.n=l.next}}}return(_regeneratorRuntime=function _regeneratorRuntime(){return{wrap:function wrap(l,c,u,p){return r.w(a(l),c,u,p&&p.reverse())},isGeneratorFunction:n,mark:r.m,awrap:function awrap(r,l){return new _OverloadYield(r,l)},AsyncIterator:_regeneratorAsyncIterator,async:function async(r,l,c,u,p){return(n(l)?_regeneratorAsyncGen:_regeneratorAsync)(a(r),l,c,u,p)},keys:_regeneratorKeys,values:_regeneratorValues}})()}function _regeneratorValues(r){if(null!=r){var l=r["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],c=0;if(l)return l.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length))return{next:function next(){return r&&c>=r.length&&(r=void 0),{value:r&&r[c++],done:!r}}}}throw new TypeError(_typeof(r)+" is not iterable")}function _regeneratorKeys(r){var l=Object(r),c=[];for(var u in l)c.unshift(u);return function e(){for(;c.length;)if((u=c.pop())in l)return e.value=u,e.done=!1,e;return e.done=!0,e}}function _regeneratorAsync(r,l,c,u,p){var m=_regeneratorAsyncGen(r,l,c,u,p);return m.next().then(function(r){return r.done?r.value:m.next()})}function _regeneratorAsyncGen(r,l,c,u,p){return new _regeneratorAsyncIterator(_regenerator().w(r,l,c,u),p||Promise)}function _regeneratorAsyncIterator(r,l){function n(c,u,p,m){try{var h=r[c](u),y=h.value;return y instanceof _OverloadYield?l.resolve(y.v).then(function(r){n("next",r,p,m)},function(r){n("throw",r,p,m)}):l.resolve(y).then(function(r){h.value=r,p(h)},function(r){return n("throw",r,p,m)})}catch(r){m(r)}}var c;this.next||(_regeneratorDefine2(_regeneratorAsyncIterator.prototype),_regeneratorDefine2(_regeneratorAsyncIterator.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),_regeneratorDefine2(this,"_invoke",function(r,u,p){function f(){return new l(function(l,c){n(r,p,l,c)})}return c=c?c.then(f,f):f()},!0)}function _regenerator(){var r,l,c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",p=c.toStringTag||"@@toStringTag";function i(c,u,p,h){var y=u&&u.prototype instanceof Generator?u:Generator,v=Object.create(y.prototype);return _regeneratorDefine2(v,"_invoke",function(c,u,p){var h,y,v,g=0,b=p||[],_=!1,D={p:0,n:0,v:r,a:d,f:d.bind(r,4),d:function d(l,c){return h=l,y=0,v=r,D.n=c,m}};function d(c,u){for(y=c,v=u,l=0;!_&&g&&!p&&l<b.length;l++){var p,h=b[l],A=D.p,w=h[2];c>3?(p=w===u)&&(v=h[(y=h[4])?5:(y=3,3)],h[4]=h[5]=r):h[0]<=A&&((p=c<2&&A<h[1])?(y=0,D.v=u,D.n=h[1]):A<w&&(p=c<3||h[0]>u||u>w)&&(h[4]=c,h[5]=u,D.n=w,y=0))}if(p||c>1)return m;throw _=!0,u}return function(p,b,A){if(g>1)throw TypeError("Generator is already running");for(_&&1===b&&d(b,A),y=b,v=A;(l=y<2?r:v)||!_;){h||(y?y<3?(y>1&&(D.n=-1),d(y,v)):D.n=v:D.v=v);try{if(g=2,h){if(y||(p="next"),l=h[p]){if(!(l=l.call(h,v)))throw TypeError("iterator result is not an object");if(!l.done)return l;v=l.value,y<2&&(y=0)}else 1===y&&(l=h.return)&&l.call(h),y<2&&(v=TypeError("The iterator does not provide a '"+p+"' method"),y=1);h=r}else if((l=(_=D.n<0)?v:c.call(u,D))!==m)break}catch(l){h=r,y=1,v=l}finally{g=1}}return{value:l,done:_}}}(c,p,h),!0),v}var m={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}l=Object.getPrototypeOf;var h=[][u]?l(l([][u]())):(_regeneratorDefine2(l={},u,function(){return this}),l),y=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(h);function f(r){return Object.setPrototypeOf?Object.setPrototypeOf(r,GeneratorFunctionPrototype):(r.__proto__=GeneratorFunctionPrototype,_regeneratorDefine2(r,p,"GeneratorFunction")),r.prototype=Object.create(y),r}return GeneratorFunction.prototype=GeneratorFunctionPrototype,_regeneratorDefine2(y,"constructor",GeneratorFunctionPrototype),_regeneratorDefine2(GeneratorFunctionPrototype,"constructor",GeneratorFunction),GeneratorFunction.displayName="GeneratorFunction",_regeneratorDefine2(GeneratorFunctionPrototype,p,"GeneratorFunction"),_regeneratorDefine2(y),_regeneratorDefine2(y,p,"Generator"),_regeneratorDefine2(y,u,function(){return this}),_regeneratorDefine2(y,"toString",function(){return"[object Generator]"}),(_regenerator=function _regenerator(){return{w:i,m:f}})()}function _regeneratorDefine2(r,l,c,u){var p=Object.defineProperty;try{p({},"",{})}catch(r){p=0}_regeneratorDefine2=function _regeneratorDefine(r,l,c,u){function o(l,c){_regeneratorDefine2(r,l,function(r){return this._invoke(l,c,r)})}l?p?p(r,l,{value:c,enumerable:!u,configurable:!u,writable:!u}):r[l]=c:(o("next",0),o("throw",1),o("return",2))},_regeneratorDefine2(r,l,c,u)}function _OverloadYield(r,l){this.v=r,this.k=l}function asyncGeneratorStep(r,l,c,u,p,m,h){try{var y=r[m](h),v=y.value}catch(r){return void c(r)}y.done?l(v):Promise.resolve(v).then(u,p)}function _asyncToGenerator(r){return function(){var l=this,c=arguments;return new Promise(function(u,p){var m=r.apply(l,c);function _next(r){asyncGeneratorStep(m,u,p,_next,_throw,"next",r)}function _throw(r){asyncGeneratorStep(m,u,p,_next,_throw,"throw",r)}_next(void 0)})}}function _classCallCheck(r,l){if(!(r instanceof l))throw new TypeError("Cannot call a class as a function")}function _defineProperties(r,l){for(var c=0;c<l.length;c++){var u=l[c];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(r,_toPropertyKey(u.key),u)}}function _createClass(r,l,c){return l&&_defineProperties(r.prototype,l),c&&_defineProperties(r,c),Object.defineProperty(r,"prototype",{writable:!1}),r}function _toPropertyKey(r){var l=function _toPrimitive(r,l){if("object"!=_typeof(r)||!r)return r;var c=r[Symbol.toPrimitive];if(void 0!==c){var u=c.call(r,l||"default");if("object"!=_typeof(u))return u;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===l?String:Number)(r)}(r,"string");return"symbol"==_typeof(l)?l:l+""}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(r,l,c){var u=function _superPropBase(r,l){for(;!{}.hasOwnProperty.call(r,l)&&null!==(r=_getPrototypeOf(r)););return r}(r,l);if(u){var p=Object.getOwnPropertyDescriptor(u,l);return p.get?p.get.call(arguments.length<3?r:c):p.value}},_get.apply(null,arguments)}function _inherits(r,l){if("function"!=typeof l&&null!==l)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(l&&l.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),Object.defineProperty(r,"prototype",{writable:!1}),l&&_setPrototypeOf(r,l)}function _setPrototypeOf(r,l){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},_setPrototypeOf(r,l)}function _createSuper(r){var l=_isNativeReflectConstruct();return function(){var c,u=_getPrototypeOf(r);if(l){var p=_getPrototypeOf(this).constructor;c=Reflect.construct(u,arguments,p)}else c=u.apply(this,arguments);return function _possibleConstructorReturn(r,l){if(l&&("object"==_typeof(l)||"function"==typeof l))return l;if(void 0!==l)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(r)}(this,c)}}function _isNativeReflectConstruct(){try{var r=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(r){}return(_isNativeReflectConstruct=function _isNativeReflectConstruct(){return!!r})()}function _getPrototypeOf(r){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_getPrototypeOf(r)}r.d({},{D:()=>c});var l={};function initConfig(){Hooks.on("updateItem",function(r){r.parent===ui.ARGON._actor&&ui.ARGON.rendered&&ui.ARGON.components.portrait.refresh()}),Hooks.on("argonInit",function(r){var u;if("dnd5e"===game.system.id){!function registerItems(){l[game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.name"),type:"feat",img:"modules/enhancedcombathud/icons/journey.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.disengage.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:1,units:"turn"},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"}},sort:0,flags:{core:{sourceId:"Item.wyQkeuZkttllAFB1"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.name"),type:"feat",img:"modules/enhancedcombathud/icons/armor-upgrade.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.dodge.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:1,units:"round"},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{statusId:{id:"dnd5edodging0000"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.ready.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.ready.name"),type:"feat",img:"modules/enhancedcombathud/icons/clockwork.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.ready.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.hide.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.hide.name"),type:"feat",img:"modules/enhancedcombathud/icons/cloak-dagger.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.hide.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},recharge:{value:null,charged:!1},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{statusId:{id:"dnd5ehiding00000"},"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.dash.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.dash.name"),type:"feat",img:"modules/enhancedcombathud/icons/walking-boot.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.dash.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:null,width:null,units:"",type:"self"},range:{value:null,long:null,units:""},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}},l[game.i18n.localize("enhancedcombathud-dnd5e.items.shove.name")]={name:game.i18n.localize("enhancedcombathud-dnd5e.items.shove.name"),type:"feat",img:"modules/enhancedcombathud/icons/shield-bash.webp",system:{type:{value:"",subtype:""},description:{value:game.i18n.localize("enhancedcombathud-dnd5e.items.shove.desc"),chat:"",unidentified:""},source:"",quantity:1,weight:0,price:0,attuned:!1,attunement:0,equipped:!1,rarity:"",identified:!0,activation:{type:"action",cost:1,condition:""},duration:{value:null,units:""},target:{value:1,width:null,units:"",type:"creature"},range:{value:null,long:null,units:"touch"},consume:{type:"",target:"",amount:null},ability:"",actionType:"util",attackBonus:0,chatFlavor:"",critical:null,damage:{parts:[],versatile:""},formula:"",save:{ability:"",dc:null,scaling:"spell"},consumableType:"trinket"},sort:0,flags:{"midi-qol":{onUseMacroName:""}}}}();var p=r.ARGON,m=function(r){_inherits(DND5eTooltip,r);var l=_createSuper(DND5eTooltip);function DND5eTooltip(){return _classCallCheck(this,DND5eTooltip),l.apply(this,arguments)}return _createClass(DND5eTooltip,[{key:"classes",get:function get(){return _get(_getPrototypeOf(DND5eTooltip.prototype),"classes",this).concat(["dnd5e2"])}}]),DND5eTooltip}(p.CORE.Tooltip),h=null===(u=game.modules.get("midi-qol"))||void 0===u?void 0:u.active,y=function getMidiFlag(r){var l,c;return h&&ui.ARGON._actor?null!==(c=(null!==(l=ui.ARGON._actor.getFlag("midi-qol","actions"))&&void 0!==l?l:{})[r])&&void 0!==c&&c?0:1:null},v=function checkActivationType(r,l){var c,u;if(null!==(c=r.activation)&&void 0!==c&&c.type)return l.includes(r.activation.type);if(null!=r&&null!==(u=r.system)&&void 0!==u&&u.activities)for(var p=0,m=Array.from(r.system.activities);p<m.length;p++){var h,y=m[p];if(l.includes(null===(h=y.activation)||void 0===h?void 0:h.type))return!0}},g=function getActivationType(r){var l,c;if(null!=r&&null!==(l=r.system)&&void 0!==l&&l.activities)return null===(c=Array.from(r.system.activities)[0])||void 0===c||null===(c=c.activation)||void 0===c?void 0:c.type},b=function getActionType(r){var l,c;if(null!=r&&null!==(l=r.system)&&void 0!==l&&null!==(l=l.activities)&&void 0!==l&&l.size)return null===(c=Array.from(r.system.activities)[0])||void 0===c?void 0:c.actionType},_={action:["action"],bonus:["bonus"],reaction:["reaction","reactiondamage","reactionmanual"],free:["special"]},D={spell:["spell"],feat:["feat"],consumable:["consumable","equipment","loot"]},A=[];game.settings.get(c,"showWeaponsItems")&&D.consumable.unshift("weapon"),game.settings.get(c,"showClassActions")&&A.push("class"),r.DND5E={actionTypes:_,itemTypes:D,mainBarFeatures:A,ECHItems:l},Hooks.callAll("enhanced-combat-hud.dnd5e.initConfig",{actionTypes:_,itemTypes:D,ECHItems:l});var w=function(r){_inherits(DND5ePortraitPanel,r);var l,c,u=_createSuper(DND5ePortraitPanel);function DND5ePortraitPanel(){_classCallCheck(this,DND5ePortraitPanel);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return u.call.apply(u,[this].concat(l))}return _createClass(DND5ePortraitPanel,[{key:"description",get:function get(){var r=this.actor,l=r.type,c=r.system,u=this.actor,p="character"===l;if("npc"===l){var m,h,y=game.i18n.localize(null!==(m=null===(h=CONFIG.DND5E.creatureTypes[u.system.details.type.value])||void 0===h?void 0:h.label)&&void 0!==m?m:u.system.details.type.custom),v=c.details.cr>=1||c.details.cr<=0?c.details.cr:"1/".concat(1/c.details.cr);return"CR ".concat(v," ").concat(y)}if(p){var g=Object.values(u.classes).map(function(r){return r.name}).join(" / ");return"Level ".concat(c.details.level," ").concat(g," (").concat(c.details.race,")")}return""}},{key:"isDead",get:function get(){return this.isDying&&"character"!==this.actor.type}},{key:"isDying",get:function get(){return this.actor.system.attributes.hp.value<=0}},{key:"successes",get:function get(){var r,l;return null!==(r=null===(l=this.actor.system.attributes)||void 0===l||null===(l=l.death)||void 0===l?void 0:l.success)&&void 0!==r?r:0}},{key:"failures",get:function get(){var r,l;return null!==(r=null===(l=this.actor.system.attributes)||void 0===l||null===(l=l.death)||void 0===l?void 0:l.failure)&&void 0!==r?r:0}},{key:"configurationTemplate",get:function get(){return"modules/enhancedcombathud-dnd5e/templates/argon-actor-config.hbs"}},{key:"_onDeathSave",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee(r){return _regeneratorRuntime().wrap(function _callee$(r){for(;;)switch(r.prev=r.next){case 0:this.actor.rollDeathSave({});case 1:case"end":return r.stop()}},_callee,this)})),function _onDeathSave(r){return c.apply(this,arguments)})},{key:"getStatBlocks",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee2(){var r,l,c,u,p,m,h,y;return _regeneratorRuntime().wrap(function _callee2$(v){for(;;)switch(v.prev=v.next){case 0:return c=game.i18n.localize("DND5E.HitPoints").split(" ").map(function(r){return r.charAt(0).toUpperCase()}).join(""),u=game.i18n.localize("DND5E.ArmorClass").split(" ").map(function(r){return r.charAt(0).toUpperCase()}).join(""),p=game.i18n.localize("DND5E.SaveDC").replace("{ability}","").replace("{dc}","").trim(),m=this.actor.system.attributes.hp.temp?"#6698f3":"rgb(0 255 170)",h=this.actor.system.attributes.hp.tempmax,y=h?h>0?"rgb(222 91 255)":"#ffb000":"rgb(255 255 255)",v.abrupt("return",[[{text:"".concat(this.actor.system.attributes.hp.value+(null!==(r=this.actor.system.attributes.hp.temp)&&void 0!==r?r:0)),color:m},{text:"/"},{text:"".concat(this.actor.system.attributes.hp.max+(null!==(l=this.actor.system.attributes.hp.tempmax)&&void 0!==l?l:0)),color:y},{text:c}],[{text:u},{text:this.actor.system.attributes.ac.value,color:"var(--ech-movement-baseMovement-background)"}],[{text:p},{text:this.actor.system.attributes.spell.dc,color:"var(--ech-movement-baseMovement-background)"}]]);case 7:case"end":return v.stop()}},_callee2,this)})),function getStatBlocks(){return l.apply(this,arguments)})}]),DND5ePortraitPanel}(p.PORTRAIT.PortraitPanel),k=function(r){_inherits(DND5eDrawerButton,r);var l,c=_createSuper(DND5eDrawerButton);function DND5eDrawerButton(r,l,u){var p;return _classCallCheck(this,DND5eDrawerButton),(p=c.call(this,r)).item=l,p.type=u,p}return _createClass(DND5eDrawerButton,[{key:"hasTooltip",get:function get(){return!0}},{key:"getTooltipData",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee3(){var r;return _regeneratorRuntime().wrap(function _callee3$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,getTooltipDetails(this.item,this.type);case 2:return r=l.sent,l.abrupt("return",r);case 4:case"end":return l.stop()}},_callee3,this)})),function getTooltipData(){return l.apply(this,arguments)})}]),DND5eDrawerButton}(p.DRAWER.DrawerButton),N=function(r){_inherits(DND5eDrawerPanel,r);var l=_createSuper(DND5eDrawerPanel);function DND5eDrawerPanel(){_classCallCheck(this,DND5eDrawerPanel);for(var r=arguments.length,c=new Array(r),u=0;u<r;u++)c[u]=arguments[u];return l.call.apply(l,[this].concat(c))}return _createClass(DND5eDrawerPanel,[{key:"categories",get:function get(){var r=this,l=this.actor.system.abilities,c=this.actor.system.skills,u=this.actor.itemTypes.tool,p=function addSign(r){return r>=0?"+".concat(r):r},m=Object.keys(l).map(function(c){var u=l[c];return new k([{label:CONFIG.DND5E.abilities[c].label,onClick:function onClick(l){return r.actor.rollAbilityCheck({ability:c,event:l})}},{label:p(u.mod+(u.checkBonus||0)),onClick:function onClick(l){return r.actor.rollAbilityCheck({ability:c,event:l})}},{label:p(u.save.value),onClick:function onClick(l){return r.actor.rollSavingThrow({ability:c,event:l})}}],c,"save")}),h=Object.keys(c).map(function(l){var u=c[l];return new k([{label:getProficiencyIcon(u.proficient)+CONFIG.DND5E.skills[l].label,onClick:function onClick(c){return r.actor.rollSkill({skill:l,event:c})}},{label:"".concat(p(u.total),'<span style="margin: 0 1rem; filter: brightness(0.8)">(').concat(u.passive,")</span>"),style:"display: flex; justify-content: flex-end;"}],l,"skill")}),y=u.map(function(c){return new k([{label:getProficiencyIcon(c.system.proficient)+c.name,onClick:function onClick(r){return c.rollToolCheck({event:r})}},{label:p(l[c.abilityMod].mod+c.system.proficiencyMultiplier*r.actor.system.attributes.prof)}],c)});return[{gridCols:"5fr 2fr 2fr",captions:[{label:game.i18n.localize("DND5E.Abilities"),align:"left"},{label:game.i18n.localize("DND5E.CHECK.Title"),align:"center"},{label:game.i18n.localize("DND5E.SAVE.Title.one"),align:"center"}],align:["left","center","center"],buttons:m},{gridCols:"7fr 2fr",captions:[{label:game.i18n.localize("DND5E.Skills")},{label:""}],buttons:h},{gridCols:"7fr 2fr",captions:[{label:game.i18n.localize("enhancedcombathud-dnd5e.hud.tools.name")},{label:""}],buttons:y}]}},{key:"title",get:function get(){return"".concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.saves.name")," / ").concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.skills.name")," / ").concat(game.i18n.localize("enhancedcombathud-dnd5e.hud.tools.name"))}}]),DND5eDrawerPanel}(p.DRAWER.DrawerPanel),P=function(u){_inherits(DND5eActionActionPanel,u);var m,h=_createSuper(DND5eActionActionPanel);function DND5eActionActionPanel(){_classCallCheck(this,DND5eActionActionPanel);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return h.call.apply(h,[this].concat(l))}return _createClass(DND5eActionActionPanel,[{key:"label",get:function get(){return"DND5E.Action"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=y("action"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(m=_asyncToGenerator(_regeneratorRuntime().mark(function _callee4(){var u,m,h,y,g,b,A,w;return _regeneratorRuntime().wrap(function _callee4$(k){for(;;)switch(k.prev=k.next){case 0:return u=this.actor.items.filter(function(l){var c;return D.spell.includes(l.type)&&v(l,_.action)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)}),m=this.actor.items.filter(function(l){var c;return D.feat.includes(l.type)&&v(l,_.action)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)}).map(function(r){return Array.from(r.system.activities)}).flat().filter(function(r){return v(r,_.action)&&"cast"!==r.type}),h=this.actor.items.filter(function(l){var c;return D.consumable.includes(l.type)&&v(l,_.action)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)}).map(function(r){return Array.from(r.system.activities)}).flat().filter(function(r){return v(r,_.action)&&"cast"!==r.type}),y=u.length?[new I({type:"spell",items:u,color:0})].filter(function(r){return r.hasContents}):[],g=Object.values(l),b=game.settings.get(c,"showSpecialActions"),A=[],b?A.push.apply(A,[new B({item:null,isWeaponSet:!0,isPrimary:!0}),new p.MAIN.BUTTONS.SplitButton(new E(g[0]),new E(g[1]))].concat(_toConsumableArray(y),[new I({type:"feat",items:m,color:0}),new p.MAIN.BUTTONS.SplitButton(new E(g[2]),new E(g[3])),new p.MAIN.BUTTONS.SplitButton(new E(g[4]),new E(g[5])),new I({type:"consumable",items:h,color:0})])):A.push.apply(A,[new B({item:null,isWeaponSet:!0,isPrimary:!0})].concat(_toConsumableArray(y),[new I({type:"feat",items:m,color:0}),new I({type:"consumable",items:h,color:0})])),w=this.actor.items.filter(function(l){var c;return r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)&&v(l,_.action)}),A.push.apply(A,_toConsumableArray(condenseItemButtons(w))),k.abrupt("return",A.filter(function(r){return r.hasContents||null==r.items||r.items.length}));case 11:case"end":return k.stop()}},_callee4,this)})),function _getButtons(){return m.apply(this,arguments)})}]),DND5eActionActionPanel}(p.MAIN.ActionPanel),C=function(l){_inherits(DND5eBonusActionPanel,l);var c,u=_createSuper(DND5eBonusActionPanel);function DND5eBonusActionPanel(){_classCallCheck(this,DND5eBonusActionPanel);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return u.call.apply(u,[this].concat(l))}return _createClass(DND5eBonusActionPanel,[{key:"label",get:function get(){return"DND5E.BonusAction"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=y("bonus"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee5(){var l,c,u,p,m,h=this;return _regeneratorRuntime().wrap(function _callee5$(y){for(;;)switch(y.prev=y.next){case 0:l=[new B({item:null,isWeaponSet:!0,isPrimary:!1})],c=_regeneratorRuntime().mark(function _loop(){var c,m,y,g,b,D,A;return _regeneratorRuntime().wrap(function _loop$(w){for(;;)switch(w.prev=w.next){case 0:if(c=_slicedToArray(p[u],2),m=c[0],y=c[1],(g=h.actor.items.filter(function(l){var c;return y.includes(l.type)&&v(l,_.bonus)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)})).length){w.next=4;break}return w.abrupt("return","continue");case 4:if("spell"!==m){w.next=8;break}return(b=new I({type:m,items:g,color:1})).hasContents&&l.push(b),w.abrupt("return","continue");case 8:if((D=g.map(function(r){return Array.from(r.system.activities)}).flat().filter(function(r){return v(r,_.bonus)})).length){w.next=11;break}return w.abrupt("return","continue");case 11:(A=new I({type:m,items:D,color:1})).hasContents&&l.push(A);case 13:case"end":return w.stop()}},_loop)}),u=0,p=Object.entries(D);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(c(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return m=this.actor.items.filter(function(l){var c;return r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)&&v(l,_.bonus)}),l.push.apply(l,_toConsumableArray(condenseItemButtons(m))),y.abrupt("return",l);case 14:case"end":return y.stop()}},_callee5,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eBonusActionPanel}(p.MAIN.ActionPanel),O=function(l){_inherits(DND5eReactionActionPanel,l);var c,u=_createSuper(DND5eReactionActionPanel);function DND5eReactionActionPanel(){_classCallCheck(this,DND5eReactionActionPanel);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return u.call.apply(u,[this].concat(l))}return _createClass(DND5eReactionActionPanel,[{key:"label",get:function get(){return"DND5E.Reaction"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return null!==(r=y("reaction"))&&void 0!==r?r:this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee6(){var l,c,u,p,m,h=this;return _regeneratorRuntime().wrap(function _callee6$(y){for(;;)switch(y.prev=y.next){case 0:l=[new B({item:null,isWeaponSet:!0,isPrimary:!0})],c=_regeneratorRuntime().mark(function _loop2(){var c,m,y,g,b,D,A;return _regeneratorRuntime().wrap(function _loop2$(w){for(;;)switch(w.prev=w.next){case 0:if(c=_slicedToArray(p[u],2),m=c[0],y=c[1],(g=h.actor.items.filter(function(l){var c;return y.includes(l.type)&&v(l,_.reaction)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)})).length){w.next=4;break}return w.abrupt("return","continue");case 4:if("spell"!==m){w.next=8;break}return(b=new I({type:m,items:g,color:1})).hasContents&&l.push(b),w.abrupt("return","continue");case 8:if((D=g.map(function(r){return Array.from(r.system.activities)}).flat().filter(function(r){return v(r,_.reaction)})).length){w.next=11;break}return w.abrupt("return","continue");case 11:(A=new I({type:m,items:D,color:3})).hasContents&&l.push(A);case 13:case"end":return w.stop()}},_loop2)}),u=0,p=Object.entries(D);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(c(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return m=this.actor.items.filter(function(l){var c;return r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)&&v(l,_.reaction)}),l.push.apply(l,_toConsumableArray(condenseItemButtons(m))),y.abrupt("return",l);case 14:case"end":return y.stop()}},_callee6,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eReactionActionPanel}(p.MAIN.ActionPanel),T=function(l){_inherits(DND5eFreeActionPanel,l);var c,u=_createSuper(DND5eFreeActionPanel);function DND5eFreeActionPanel(){_classCallCheck(this,DND5eFreeActionPanel);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return u.call.apply(u,[this].concat(l))}return _createClass(DND5eFreeActionPanel,[{key:"label",get:function get(){return"DND5E.Special"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){return this.isActionUsed?0:1}},{key:"_onNewRound",value:function _onNewRound(r){this.isActionUsed=!1,this.updateActionUse()}},{key:"_getButtons",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee7(){var l,c,u,p,m,h=this;return _regeneratorRuntime().wrap(function _callee7$(y){for(;;)switch(y.prev=y.next){case 0:l=[],c=_regeneratorRuntime().mark(function _loop3(){var c,m,y,g,b,D,A;return _regeneratorRuntime().wrap(function _loop3$(w){for(;;)switch(w.prev=w.next){case 0:if(c=_slicedToArray(p[u],2),m=c[0],y=c[1],(g=h.actor.items.filter(function(l){var c;return y.includes(l.type)&&v(l,_.free)&&!r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)})).length){w.next=4;break}return w.abrupt("return","continue");case 4:if("spell"!==m){w.next=8;break}return(b=new I({type:m,items:g,color:1})).hasContents&&l.push(b),w.abrupt("return","continue");case 8:if((D=g.map(function(r){return Array.from(r.system.activities)}).flat().filter(function(r){return v(r,_.free)})).length){w.next=11;break}return w.abrupt("return","continue");case 11:(A=new I({type:m,items:D,color:2})).hasContents&&l.push(A);case 13:case"end":return w.stop()}},_loop3)}),u=0,p=Object.entries(D);case 3:if(!(u<p.length)){y.next=11;break}return y.delegateYield(c(),"t0",5);case 5:if("continue"!==y.t0){y.next=8;break}return y.abrupt("continue",8);case 8:u++,y.next=3;break;case 11:return m=this.actor.items.filter(function(l){var c;return r.DND5E.mainBarFeatures.includes(null===(c=l.system.type)||void 0===c?void 0:c.value)&&v(l,_.free)}),l.push.apply(l,_toConsumableArray(condenseItemButtons(m))),y.abrupt("return",l);case 14:case"end":return y.stop()}},_callee7,this)})),function _getButtons(){return c.apply(this,arguments)})}]),DND5eFreeActionPanel}(p.MAIN.ActionPanel),x=function(r){_inherits(DND5eLegActionPanel,r);var l,c=_createSuper(DND5eLegActionPanel);function DND5eLegActionPanel(){_classCallCheck(this,DND5eLegActionPanel);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return c.call.apply(c,[this].concat(l))}return _createClass(DND5eLegActionPanel,[{key:"label",get:function get(){return"DND5E.LegendaryAction.Label"}},{key:"maxActions",get:function get(){var r,l,c;return null!==(r=this.actor)&&void 0!==r&&r.inCombat&&null!==(l=null===(c=this.actor.system.resources)||void 0===c||null===(c=c.legact)||void 0===c?void 0:c.max)&&void 0!==l?l:null}},{key:"currentActions",get:function get(){var r,l;return null!==(r=null===(l=this.actor.system.resources)||void 0===l||null===(l=l.legact)||void 0===l?void 0:l.value)&&void 0!==r?r:null}},{key:"_getButtons",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee8(){var r;return _regeneratorRuntime().wrap(function _callee8$(l){for(;;)switch(l.prev=l.next){case 0:return r=[],this.actor.items.filter(function(r){return"legendary"===g(r)}).forEach(function(l){r.push(new B({item:l,inActionPanel:!0}))}),l.abrupt("return",r);case 4:case"end":return l.stop()}},_callee8,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eLegActionPanel}(p.MAIN.ActionPanel),S=function(r){_inherits(DND5eLairActionPanel,r);var l,c=_createSuper(DND5eLairActionPanel);function DND5eLairActionPanel(){_classCallCheck(this,DND5eLairActionPanel);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return c.call.apply(c,[this].concat(l))}return _createClass(DND5eLairActionPanel,[{key:"label",get:function get(){return"DND5E.LAIR.Action.Label"}},{key:"maxActions",get:function get(){var r;return null!==(r=this.actor)&&void 0!==r&&r.inCombat?1:null}},{key:"currentActions",get:function get(){var r;return 1*(null===(r=this.actor.system.resources.lair)||void 0===r?void 0:r.value)}},{key:"_getButtons",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee9(){var r;return _regeneratorRuntime().wrap(function _callee9$(l){for(;;)switch(l.prev=l.next){case 0:return r=[],this.actor.items.filter(function(r){return"lair"===g(r)}).forEach(function(l){r.push(new B({item:l,inActionPanel:!0}))}),l.abrupt("return",r);case 4:case"end":return l.stop()}},_callee9,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eLairActionPanel}(p.MAIN.ActionPanel),R=function(r){_inherits(DND5eMythicActionPanel,r);var l,c=_createSuper(DND5eMythicActionPanel);function DND5eMythicActionPanel(){_classCallCheck(this,DND5eMythicActionPanel);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return c.call.apply(c,[this].concat(l))}return _createClass(DND5eMythicActionPanel,[{key:"label",get:function get(){return"DND5E.MythicActionLabel"}},{key:"maxActions",get:function get(){return null}},{key:"currentActions",get:function get(){return null}},{key:"_getButtons",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee0(){var r;return _regeneratorRuntime().wrap(function _callee0$(l){for(;;)switch(l.prev=l.next){case 0:return r=[],this.actor.items.filter(function(r){return"mythic"===g(r)}).forEach(function(l){r.push(new B({item:l,inActionPanel:!0}))}),l.abrupt("return",r);case 4:case"end":return l.stop()}},_callee0,this)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eMythicActionPanel}(p.MAIN.ActionPanel),B=function(r){_inherits(DND5eItemButton,r);var l,c,u,p,m=_createSuper(DND5eItemButton);function DND5eItemButton(){_classCallCheck(this,DND5eItemButton);for(var r=arguments.length,l=new Array(r),c=0;c<r;c++)l[c]=arguments[c];return m.call.apply(m,[this].concat(l))}return _createClass(DND5eItemButton,[{key:"item",get:function get(){var r,l;return null!==(r=null===(l=this._item)||void 0===l?void 0:l.item)&&void 0!==r?r:this._item}},{key:"isActivity",get:function get(){var r;return!(null!==(r=this._item)&&void 0!==r&&null!==(r=r.system)&&void 0!==r&&r.activities)}},{key:"activity",get:function get(){return this.isActivity?this._item:Array.from(this._item.system.activities)[0]}},{key:"hasTooltip",get:function get(){return!0}},{key:"ranges",get:function get(){var r,l,c,u,p,m=this.activity,h="touch"==m.range.units?null===(r=canvas)||void 0===r||null===(r=r.scene)||void 0===r||null===(r=r.grid)||void 0===r?void 0:r.distance:null;return{normal:null!==(l=null==m||null===(c=m.range)||void 0===c?void 0:c.value)&&void 0!==l?l:h,long:null!==(u=null==m||null===(p=m.range)||void 0===p?void 0:p.long)&&void 0!==u?u:null}}},{key:"label",get:function get(){return this.isActivity?this.activity.name+" (".concat(this.item.name,")"):_get(_getPrototypeOf(DND5eItemButton.prototype),"label",this)}},{key:"targets",get:function get(){var r,l,c,u,p=this.activity,m=["creature","ally","enemy"],h=p.actionType,y=null!==(r=null===(l=p.target)||void 0===l?void 0:l.affects)&&void 0!==r?r:{},v=y.type;return null!==(c=p.target)&&void 0!==c&&null!==(c=c.template)&&void 0!==c&&c.units||!m.includes(v)?m.includes(v)&&y.count?y.count:"mwak"===h||"rwak"===h||"msak"===h||"rsak"===h?y.count||1:null:null!==(u=y.count)&&void 0!==u?u:1}},{key:"visible",get:function get(){var r,l;if(!this._isWeaponSet)return _get(_getPrototypeOf(DND5eItemButton.prototype),"visible",this);var c=this.parent instanceof O,u="mwak"===(null===(r=this.activity)||void 0===r?void 0:r.actionType);return!(c&&!u)&&((this._isPrimary||"shield"!==(null===(l=this.activity)||void 0===l||null===(l=l.type)||void 0===l?void 0:l.value))&&_get(_getPrototypeOf(DND5eItemButton.prototype),"visible",this))}},{key:"getTooltipData",value:(p=_asyncToGenerator(_regeneratorRuntime().mark(function _callee1(){var r;return _regeneratorRuntime().wrap(function _callee1$(l){for(;;)switch(l.prev=l.next){case 0:if(!this.isActivity){l.next=6;break}return l.next=3,getTooltipDetails(_objectSpread(_objectSpread(_objectSpread({},this.item),this.activity),{},{name:this.label}));case 3:l.t0=l.sent,l.next=9;break;case 6:return l.next=8,getTooltipDetails(this.item);case 8:l.t0=l.sent;case 9:return(r=l.t0).propertiesLabel="enhancedcombathud-dnd5e.tooltip.properties.name",l.abrupt("return",r);case 12:case"end":return l.stop()}},_callee1,this)})),function getTooltipData(){return p.apply(this,arguments)})},{key:"_onLeftClick",value:(u=_asyncToGenerator(_regeneratorRuntime().mark(function _callee10(r){var l,c,u,p;return _regeneratorRuntime().wrap(function _callee10$(m){for(;;)switch(m.prev=m.next){case 0:return m.next=2,this.activity.use({event:r,legacy:!1},{event:r});case 2:m.sent&&(DND5eItemButton.consumeActionEconomy(this.activity),(c=null===(l=this.activity)||void 0===l||null===(l=l.consumption)||void 0===l||null===(l=l.targets)||void 0===l?void 0:l.find(function(r){return"itemUses"===r.type}))&&(u=this.actor.items.get(c.target),p=this.actor.items.filter(function(r){var l;return null===(l=r.system.activities)||void 0===l?void 0:l.find(function(r){var l;return null===(l=r.consumption)||void 0===l||null===(l=l.targets)||void 0===l?void 0:l.find(function(r){return"itemUses"===r.type&&r.target===u.id})})}),ui.ARGON.updateItemButtons(p)),this.render(!0));case 4:case"end":return m.stop()}},_callee10,this)})),function _onLeftClick(r){return u.apply(this,arguments)})},{key:"_onRightClick",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee11(r){var l;return _regeneratorRuntime().wrap(function _callee11$(r){for(;;)switch(r.prev=r.next){case 0:null===(l=this.activity)||void 0===l||null===(l=l.sheet)||void 0===l||l.render(!0);case 1:case"end":return r.stop()}},_callee11,this)})),function _onRightClick(r){return c.apply(this,arguments)})},{key:"render",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee12(){var r,l,c,u,p,m=this,h=arguments;return _regeneratorRuntime().wrap(function _callee12$(y){for(;;)switch(y.prev=y.next){case 0:for(l=h.length,c=new Array(l),u=0;u<l;u++)c[u]=h[u];return y.next=3,(r=_get(_getPrototypeOf(DND5eItemButton.prototype),"render",this)).call.apply(r,[this].concat(c));case 3:this.activity&&(p=this.actor.items.filter(function(r){var l;return(null===(l=r.consume)||void 0===l?void 0:l.target)===m.activity.id}),ui.ARGON.updateItemButtons(p));case 4:case"end":return y.stop()}},_callee12,this)})),function render(){return l.apply(this,arguments)})},{key:"quantity",get:function get(){var r,l,c,u;if(!this.item)return null;if(null!==(r=this.item.system.uses)&&void 0!==r&&r.max)return this.item.system.uses.max-this.item.system.uses.spent;if(!this.activity)return null;var p=null===(l=this.activity)||void 0===l||null===(l=l.consume)||void 0===l?void 0:l.type,m=null===(c=this.item.system.ammunition)||void 0===c?void 0:c.type,h=null===(u=this.activity)||void 0===u||null===(u=u.consumption)||void 0===u||null===(u=u.targets)||void 0===u?void 0:u.find(function(r){return"itemUses"===r.type});if(h){var y,v=this.actor.items.get(h.target);if(v&&null!==(y=v.system.uses)&&void 0!==y&&y.max)return v.system.uses.max-v.system.uses.spent}if(m){var g,b,_=null===(g=this.item.system.ammunitionOptions[0])||void 0===g?void 0:g.item;return _?Math.floor(null!==(b=_.system.quantity)&&void 0!==b?b:0):null}if("attribute"===p)return Math.floor(getProperty(this.actor,this.activity.consume.target)/this.activity.consume.amount);if("charges"===p){var D,A,w=this.actor.items.get(this.activity.consume.target);return w?Math.floor((null!==(D=null===(A=w.uses)||void 0===A?void 0:A.value)&&void 0!==D?D:0)/this.activity.consume.amount):null}return["consumable"].includes(this.item.type)&&!this.activity.uses.max?this.item.system.quantity:null!==this.activity.uses.value&&null!==this.activity.uses.per&&this.activity.uses.max?this.activity.uses.value:null}}],[{key:"consumeActionEconomy",value:function consumeActionEconomy(r){for(var l,c,u=null==r||null===(l=r.activation)||void 0===l?void 0:l.type,p=null,m=0,h=Object.entries(_);m<h.length;m++){var y=_slicedToArray(h[m],2),v=y[0];y[1].includes(u)&&(p=v)}p&&((null===(c=game.combat)||void 0===c||null===(c=c.combatant)||void 0===c?void 0:c.actor)!==r.item.parent&&(p="reaction"),"action"===p?(ui.ARGON.components.main[0].isActionUsed=!0,ui.ARGON.components.main[0].updateActionUse()):"bonus"===p?(ui.ARGON.components.main[1].isActionUsed=!0,ui.ARGON.components.main[1].updateActionUse()):"reaction"===p?(ui.ARGON.components.main[2].isActionUsed=!0,ui.ARGON.components.main[2].updateActionUse()):"free"===p?(ui.ARGON.components.main[3].isActionUsed=!0,ui.ARGON.components.main[3].updateActionUse()):"legendary"===p&&(ui.ARGON.components.main[4].isActionUsed=!0))}}]),DND5eItemButton}(p.MAIN.BUTTONS.ItemButton),I=function(r){_inherits(DND5eButtonPanelButton,r);var l,u=_createSuper(DND5eButtonPanelButton);function DND5eButtonPanelButton(r){var l,c=r.type,p=r.items,m=r.color;return _classCallCheck(this,DND5eButtonPanelButton),(l=u.call(this)).type=c,l.items=p,l.color=m,l.itemsWithSpells=[],l._spells=l.prePrepareSpells(),l}return _createClass(DND5eButtonPanelButton,[{key:"hasContents",get:function get(){return this._spells?!!this._spells.length||!!this.itemsWithSpells.length:!!this.items.length}},{key:"colorScheme",get:function get(){return this.color}},{key:"id",get:function get(){return"".concat(this.type,"-").concat(this.color)}},{key:"label",get:function get(){switch(this.type){case"spell":return"enhancedcombathud-dnd5e.hud.castspell.name";case"feat":return"enhancedcombathud-dnd5e.hud.usepower.name";case"consumable":case"weapon":return"enhancedcombathud-dnd5e.hud.useitem.name"}}},{key:"icon",get:function get(){switch(this.type){case"spell":return"modules/enhancedcombathud/icons/spell-book.webp";case"feat":return"modules/enhancedcombathud/icons/mighty-force.webp";case"consumable":case"weapon":return"modules/enhancedcombathud/icons/drink-me.webp"}}},{key:"showPreparedOnly",get:function get(){if("character"!==this.actor.type)return!1;var r=this.actor.getFlag(c,"showPrepared");if("all"===r)return!1;if("preparedOnly"===r)return!0;var l=Object.keys(this.actor.classes);return["cleric","druid","paladin","wizard","artificer"].some(function(r){return l.includes(r)})}},{key:"prePrepareSpells",value:function prePrepareSpells(){var r=this;if("spell"===this.type){var l=CONFIG.DND5E.spellLevels,c=[],u=new Map;this.items.filter(function(r){var l;return null===(l=r.flags.dnd5e)||void 0===l?void 0:l.cachedFor}).forEach(function(l){var p=fromUuidSync(r.actor.documentName+"."+r.actor.id+l.flags.dnd5e.cachedFor);if(c.push(l),null!=p&&p.displayInSpellbook){var m=p.item,h=u.get(m);h?h.push(l):u.set(m,[l])}});var p,m=_createForOfIteratorHelper(u);try{var h=function _loop5(){var l=_slicedToArray(p.value,2),c=l[0],u=l[1];r.itemsWithSpells.push({label:c.name,buttons:u.map(function(r){return new B({item:r})}),uses:function uses(){var r,l;return{max:null===(r=c.system)||void 0===r||null===(r=r.uses)||void 0===r?void 0:r.max,value:null===(l=c.system)||void 0===l||null===(l=l.uses)||void 0===l?void 0:l.value}}})};for(m.s();!(p=m.n()).done;)h()}catch(r){m.e(r)}finally{m.f()}if(this.items=this.items.filter(function(r){return!c.includes(r)}),this.showPreparedOnly){var y=["atwill","innate","pact"];this.items=this.items.filter(function(r){var l,c,u;return!!y.includes(null===(l=r.system)||void 0===l?void 0:l.method)||(0==(null===(c=r.system)||void 0===c?void 0:c.level)||(null===(u=r.system)||void 0===u?void 0:u.prepared)>0)})}for(var v=[].concat(_toConsumableArray(this.itemsWithSpells),[{label:"DND5E.SpellPrepAtWill",buttons:this.items.filter(function(r){var l;return"atwill"===(null===(l=r.system)||void 0===l?void 0:l.method)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:"DND5E.SpellPrepInnate",buttons:this.items.filter(function(r){var l;return"innate"===(null===(l=r.system)||void 0===l?void 0:l.method)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:Object.values(l)[0],buttons:this.items.filter(function(r){var l;return 0==(null===(l=r.system)||void 0===l?void 0:l.level)}).map(function(r){return new B({item:r})}),uses:{max:1/0,value:1/0}},{label:"DND5E.PactMagic",buttons:this.items.filter(function(r){var l;return"pact"===(null===(l=r.system)||void 0===l?void 0:l.method)}).map(function(r){return new B({item:r})}),uses:function uses(){return r.actor.system.spells.pact}}]),g=function _loop4(){var l=_slicedToArray(_[b],2),c=l[0],u=l[1],p=r.items.filter(function(r){var l,u;return(null===(l=r.system)||void 0===l?void 0:l.level)==c&&"spell"===(null===(u=r.system)||void 0===u?void 0:u.method)});if(!p.length||0==c)return"continue";v.push({label:u,buttons:p.map(function(r){return new B({item:r})}),uses:function uses(){return r.actor.system.spells["spell".concat(c)]}})},b=0,_=Object.entries(l);b<_.length;b++)g();return v.filter(function(r){return r.buttons.length})}}},{key:"_getPanel",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee13(){return _regeneratorRuntime().wrap(function _callee13$(r){for(;;)switch(r.prev=r.next){case 0:if("spell"!==this.type){r.next=4;break}return r.abrupt("return",new p.MAIN.BUTTON_PANELS.ACCORDION.AccordionPanel({id:this.id,accordionPanelCategories:this._spells.map(function(r){var l=r.label,c=r.buttons,u=r.uses;return new p.MAIN.BUTTON_PANELS.ACCORDION.AccordionPanelCategory({label:l,buttons:c,uses:u})})}));case 4:return r.abrupt("return",new p.MAIN.BUTTON_PANELS.ButtonPanel({id:this.id,buttons:this.items.map(function(r){return new B({item:r})})}));case 5:case"end":return r.stop()}},_callee13,this)})),function _getPanel(){return l.apply(this,arguments)})}]),DND5eButtonPanelButton}(p.MAIN.BUTTONS.ButtonPanelButton),E=function(r){_inherits(DND5eSpecialActionButton,r);var l,c,u,p=_createSuper(DND5eSpecialActionButton);function DND5eSpecialActionButton(r){var l,c;_classCallCheck(this,DND5eSpecialActionButton);var u=(c=p.call(this)).actor.items.getName(r.name);return c.actorItem=u,c.statusId=null===(l=r.flags)||void 0===l||null===(l=l.statusId)||void 0===l?void 0:l.id,c.item=null!=u?u:new CONFIG.Item.documentClass(r,{parent:c.actor}),c}return _createClass(DND5eSpecialActionButton,[{key:"label",get:function get(){return this.item.name}},{key:"icon",get:function get(){return this.item.img}},{key:"hasTooltip",get:function get(){return!0}},{key:"activity",get:function get(){var r;if(null!==(r=this.item)&&void 0!==r&&null!==(r=r.system)&&void 0!==r&&r.activities)return Array.from(this.item.system.activities)[0]}},{key:"getTooltipData",value:(u=_asyncToGenerator(_regeneratorRuntime().mark(function _callee14(){var r;return _regeneratorRuntime().wrap(function _callee14$(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,getTooltipDetails(this.item);case 2:return(r=l.sent).propertiesLabel="enhancedcombathud-dnd5e.tooltip.properties.name",l.abrupt("return",r);case 5:case"end":return l.stop()}},_callee14,this)})),function getTooltipData(){return u.apply(this,arguments)})},{key:"_onLeftClick",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee15(r){var l,c,u,p,m=this;return _regeneratorRuntime().wrap(function _callee15$(h){for(;;)switch(h.prev=h.next){case 0:if(c=(null===(l=game.modules.get("dfreds-convenient-effects"))||void 0===l?void 0:l.active)&&game.dfreds.effectInterface.findEffect({effectName:this.label}),u=!1,!c){h.next=8;break}return u=!0,h.next=6,game.dfreds.effectInterface.toggleEffect({effectName:this.label,overlay:!1,uuids:[this.actor.uuid]});case 6:h.next=19;break;case 8:if(!this.actorItem){h.next=14;break}return h.next=11,this.activity.use({event:r},{event:r});case 11:h.t0=h.sent,h.next=17;break;case 14:return h.next=16,this.createChatMessage();case 16:h.t0=h.sent;case 17:u=h.t0,this.statusId&&(p=CONFIG.statusEffects.find(function(r){return r._id===m.statusId}))&&this.actor.toggleStatusEffect(p.id);case 19:u&&B.consumeActionEconomy(this.item);case 20:case"end":return h.stop()}},_callee15,this)})),function _onLeftClick(r){return c.apply(this,arguments)})},{key:"createChatMessage",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee16(){return _regeneratorRuntime().wrap(function _callee16$(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ChatMessage.create({user:game.user,speaker:{actor:this.actor,token:this.actor.token,alias:this.actor.name},content:'\n                    <div class="dnd5e2 chat-card item-card" data-display-challenge="">\n\n    <section class="card-header description collapsible">\n\n        <header class="summary">\n            <img class="gold-icon" src="'.concat(this.icon,'">\n            <div class="name-stacked border">\n                <span class="title">').concat(this.label,'</span>\n                <span class="subtitle">\n                    Feature\n                </span>\n            </div>\n            <i class="fas fa-chevron-down fa-fw"></i>\n        </header>\n\n        <section class="details collapsible-content card-content">\n            <div class="wrapper">\n                ').concat(this.item.system.description.value,"\n            </div>\n        </section>\n    </section>\n\n\n</div>\n                    ")});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},_callee16,this)})),function createChatMessage(){return l.apply(this,arguments)})}]),DND5eSpecialActionButton}(p.MAIN.BUTTONS.ActionButton),G=function(r){_inherits(DND5eMovementHud,r);var l=_createSuper(DND5eMovementHud);function DND5eMovementHud(){return _classCallCheck(this,DND5eMovementHud),l.apply(this,arguments)}return _createClass(DND5eMovementHud,[{key:"movementMax",get:function get(){return this.actor&&this.actor.system.attributes.movement[this.movementMode]?this.actor.system.attributes.movement[this.movementMode]/canvas.scene.dimensions.distance:0}}]),DND5eMovementHud}(p.MovementHud),j=function(r){_inherits(DND5eButtonHud,r);var l,c=_createSuper(DND5eButtonHud);function DND5eButtonHud(){_classCallCheck(this,DND5eButtonHud);for(var r=arguments.length,l=new Array(r),u=0;u<r;u++)l[u]=arguments[u];return c.call.apply(c,[this].concat(l))}return _createClass(DND5eButtonHud,[{key:"visible",get:function get(){var r;return!(null!==(r=game.combat)&&void 0!==r&&r.started)}},{key:"_getButtons",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee17(){var r=this;return _regeneratorRuntime().wrap(function _callee17$(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",[{label:"DND5E.REST.Long.Label",onClick:function onClick(l){return r.actor.longRest()},icon:"fas fa-bed"},{label:"DND5E.REST.Short.Label",onClick:function onClick(l){return r.actor.shortRest()},icon:"fas fa-coffee"}]);case 1:case"end":return l.stop()}},_callee17)})),function _getButtons(){return l.apply(this,arguments)})}]),DND5eButtonHud}(p.ButtonHud),M=function(r){_inherits(DND5eWeaponSets,r);var l,c,u,p=_createSuper(DND5eWeaponSets);function DND5eWeaponSets(){return _classCallCheck(this,DND5eWeaponSets),p.apply(this,arguments)}return _createClass(DND5eWeaponSets,[{key:"getDefaultSets",value:(u=_asyncToGenerator(_regeneratorRuntime().mark(function _callee18(){var r,l,c,u,p,m,h,y,v,b,_,D,A,w,k,N,P;return _regeneratorRuntime().wrap(function _callee18$(C){for(;;)switch(C.prev=C.next){case 0:return C.next=2,_get(_getPrototypeOf(DND5eWeaponSets.prototype),"getDefaultSets",this).call(this);case 2:if(w=C.sent,k=null===(r=this.actor.flags)||void 0===r||null===(r=r.dnd5e)||void 0===r?void 0:r.isPolymorphed,"npc"===this.actor.type||k){C.next=6;break}return C.abrupt("return",w);case 6:return N=this.actor.items.filter(function(r){return"weapon"===r.type&&"action"===g(r)}),P=this.actor.items.filter(function(r){return"weapon"===r.type&&"bonus"===g(r)}),C.abrupt("return",{1:{primary:null!==(l=null===(c=N[0])||void 0===c?void 0:c.uuid)&&void 0!==l?l:null,secondary:null!==(u=null===(p=P[0])||void 0===p?void 0:p.uuid)&&void 0!==u?u:null},2:{primary:null!==(m=null===(h=N[1])||void 0===h?void 0:h.uuid)&&void 0!==m?m:null,secondary:null!==(y=null===(v=P[1])||void 0===v?void 0:v.uuid)&&void 0!==y?y:null},3:{primary:null!==(b=null===(_=N[2])||void 0===_?void 0:_.uuid)&&void 0!==b?b:null,secondary:null!==(D=null===(A=P[2])||void 0===A?void 0:A.uuid)&&void 0!==D?D:null}});case 9:case"end":return C.stop()}},_callee18,this)})),function getDefaultSets(){return u.apply(this,arguments)})},{key:"_getSets",value:(c=_asyncToGenerator(_regeneratorRuntime().mark(function _callee19(){var r,l,c,u,p,m;return _regeneratorRuntime().wrap(function _callee19$(h){for(;;)switch(h.prev=h.next){case 0:if(!(null===(r=this.actor.flags)||void 0===r||null===(r=r.dnd5e)||void 0===r?void 0:r.isPolymorphed)){h.next=7;break}return h.next=4,this.getDefaultSets();case 4:h.t0=h.sent,h.next=13;break;case 7:return h.t1=foundry.utils,h.next=10,this.getDefaultSets();case 10:h.t2=h.sent,h.t3=foundry.utils.deepClone(this.actor.getFlag("enhancedcombathud","weaponSets")||{}),h.t0=h.t1.mergeObject.call(h.t1,h.t2,h.t3);case 13:l=h.t0,c=0,u=Object.entries(l);case 15:if(!(c<u.length)){h.next=36;break}if((p=_slicedToArray(u[c],2))[0],!(m=p[1]).primary){h.next=23;break}return h.next=20,fromUuid(m.primary);case 20:h.t4=h.sent,h.next=24;break;case 23:h.t4=null;case 24:if(m.primary=h.t4,!m.secondary){h.next=31;break}return h.next=28,fromUuid(m.secondary);case 28:h.t5=h.sent,h.next=32;break;case 31:h.t5=null;case 32:m.secondary=h.t5;case 33:c++,h.next=15;break;case 36:return h.abrupt("return",l);case 37:case"end":return h.stop()}},_callee19,this)})),function _getSets(){return c.apply(this,arguments)})},{key:"_onSetChange",value:(l=_asyncToGenerator(_regeneratorRuntime().mark(function _callee20(r){var l,c,u,p,m,h,y;return _regeneratorRuntime().wrap(function _callee20$(v){for(;;)switch(v.prev=v.next){case 0:if(l=r.sets,c=r.active,game.settings.get("enhancedcombathud-dnd5e","switchEquip")){v.next=4;break}return v.abrupt("return");case 4:return u=[],p=l[c],m=Object.values(p).filter(function(r){return r}),h=Object.values(l).filter(function(r){return r!==p}),y=h.flatMap(function(r){return Object.values(r)}).filter(function(r){return r}).filter(function(r){return!m.includes(r)}),m.forEach(function(r){var l;null!==(l=r.system)&&void 0!==l&&l.equipped||u.push({_id:r.id,"system.equipped":!0})}),y.forEach(function(r){var l;null!==(l=r.system)&&void 0!==l&&l.equipped&&u.push({_id:r.id,"system.equipped":!1})}),v.next=13,this.actor.updateEmbeddedDocuments("Item",u);case 13:return v.abrupt("return",v.sent);case 14:case"end":return v.stop()}},_callee20,this)})),function _onSetChange(r){return l.apply(this,arguments)})}]),DND5eWeaponSets}(p.WeaponSets),z=game.settings.get(c,"macroPanel"),U=[P,C,O,T,x,S,R];z&&U.push(p.PREFAB.MacroPanel),U.push(p.PREFAB.PassTurnPanel),r.definePortraitPanel(w),r.defineDrawerPanel(N),r.defineMainPanels(U),r.defineMovementHud(G),r.defineButtonHud(j),r.defineWeaponSets(M),r.defineTooltip(m),r.defineSupportedActorTypes(["character","npc"])}function getTooltipDetails(r,l){return _getTooltipDetails.apply(this,arguments)}function _getTooltipDetails(){return(_getTooltipDetails=_asyncToGenerator(_regeneratorRuntime().mark(function _callee21(r,l){var c,u,p,m,h,y,v,g,_,D,A,w,k,N,P,C,O,T,x,S,R,B,I,E,G,j,M,z,U,L,q;return _regeneratorRuntime().wrap(function _callee21$(H){for(;;)switch(H.prev=H.next){case 0:if(w=[],k=[],N="","skill"!=l){H.next=8;break}h=CONFIG.DND5E.skills[r].label,y=game.i18n.localize("enhancedcombathud-dnd5e.skills.".concat(r,".tooltip")),H.next=48;break;case 8:if("save"!=l){H.next=13;break}h=CONFIG.DND5E.abilities[r].label,y=game.i18n.localize("enhancedcombathud-dnd5e.abilities.".concat(r,".tooltip")),H.next=48;break;case 13:if(r&&r.system){H.next=15;break}return H.abrupt("return");case 15:h=r.name,y=r.system.identified?r.system.description.value:null!==(P=r.system.description.unidentified)&&void 0!==P?P:r.system.description.value,v=r.type,_=(null===(C=r.labels)||void 0===C?void 0:C.target)||"-",D=(null===(O=r.labels)||void 0===O?void 0:O.range)||"-",k=[],A=null==r||null===(T=r.labels)||void 0===T||null===(T=T.damages)||void 0===T?void 0:T.map(function(r){return r.damageType}),w=A&&A.length?A:[],N="",H.t0=v,H.next="weapon"===H.t0?27:"spell"===H.t0?32:"consumable"===H.t0?40:"feat"===H.t0?44:48;break;case 27:for(g=CONFIG.DND5E.weaponTypes[r.system.weaponType],(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),S=0,R=Object.entries(r.system.properties);S<R.length;S++)B=_slicedToArray(R[S],2),I=B[0],E=B[1],(G=E&&CONFIG.DND5E.weaponProperties[I]?CONFIG.DND5E.weaponProperties[I]:void 0)&&k.push(G);return H.abrupt("break",48);case 32:g="".concat(r.labels.level," ").concat(r.labels.school),k.push(CONFIG.DND5E.spellSchools[r.system.school]),k.push(r.labels.duration),k.push(r.labels.save),j=_createForOfIteratorHelper(r.labels.components.all);try{for(j.s();!(M=j.n()).done;)z=M.value,k.push(z.abbr)}catch(r){j.e(r)}finally{j.f()}return r.labels.materials&&(N=r.labels.materials),H.abrupt("break",48);case 40:return g=CONFIG.DND5E.consumableTypes[r.system.consumableType],(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),H.abrupt("break",48);case 44:return g=r.system.requirements,(x=CONFIG.DND5E.itemActionTypes[b(r)])&&k.push(x),H.abrupt("break",48);case 48:if(!y){H.next=52;break}return H.next=51,foundry.applications.ux.TextEditor.implementation.enrichHTML(y,{async:!0,relativeTo:r});case 51:y=H.sent;case 52:return U=[],(_||D)&&(U=[{label:"enhancedcombathud-dnd5e.tooltip.target.name",value:_},{label:"enhancedcombathud-dnd5e.tooltip.range.name",value:D}]),null!=r&&null!==(c=r.labels)&&void 0!==c&&c.toHit&&U.push({label:"enhancedcombathud-dnd5e.tooltip.toHit.name",value:r.labels.toHit}),null!=r&&null!==(u=r.labels)&&void 0!==u&&null!==(u=u.damages)&&void 0!==u&&u.length&&(L="",r.labels.damages.forEach(function(r){L+=r.formula+" "+getDamageTypeIcon(r.damageType)+" "}),U.push({label:"enhancedcombathud-dnd5e.tooltip.damage.name",value:L})),q=[],null!==(p=w)&&void 0!==p&&p.length&&w.forEach(function(r){return q.push({label:r,primary:!0})}),null!==(m=k)&&void 0!==m&&m.length&&k.forEach(function(r){var l;return q.push({label:null!==(l=null==r?void 0:r.label)&&void 0!==l?l:r,secondary:!0})}),H.abrupt("return",{title:h,description:y,subtitle:g,details:U,properties:q,footerText:N});case 60:case"end":return H.stop()}},_callee21)}))).apply(this,arguments)}function getDamageTypeIcon(r){var l;switch(null!==(l=r)&&void 0!==l||(r=""),r.toLowerCase()){case"acid":return'<i class="fas fa-flask"></i>';case"bludgeoning":return'<i class="fas fa-hammer"></i>';case"cold":return'<i class="fas fa-snowflake"></i>';case"fire":return'<i class="fas fa-fire"></i>';case"force":return'<i class="fas fa-hand-sparkles"></i>';case"lightning":return'<i class="fas fa-bolt"></i>';case"necrotic":return'<i class="fas fa-skull"></i>';case"piercing":return'<i class="fas fa-crosshairs"></i>';case"poison":return'<i class="fas fa-skull-crossbones"></i>';case"psychic":return'<i class="fas fa-brain"></i>';case"radiant":return'<i class="fas fa-sun"></i>';case"slashing":return'<i class="fas fa-cut"></i>';case"thunder":return'<i class="fas fa-bell"></i>';case"healing":return'<i class="fas fa-heart"></i>';default:return'<i class="fas fa-sparkles"></i>'}}function getProficiencyIcon(r){return 0==r?'<i style="margin-right: 1ch; pointer-events: none" class="far fa-circle"> </i>':1==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-check"> </i>':2==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-check-double"> </i>':.5==r?'<i style="margin-right: 1ch; pointer-events: none" class="fas fa-adjust"> </i>':'<i style="margin-right: 1ch; pointer-events: none" class="far fa-circle"> </i>'}function condenseItemButtons(r){if(!game.settings.get(c,"condenseClassActions"))return r.map(function(r){return new B({item:r,inActionPanel:!0})});for(var l=[],u=r.length,m=u-u%2,h=null,y=0;y<u;y++){var v=y<m,g=r[y];if(v)if(h){var b=new B({item:g,inActionPanel:!1});l.push(new p.MAIN.BUTTONS.SplitButton(h,b)),h=null}else h=new B({item:g,inActionPanel:!1});else l.push(new B({item:g,inActionPanel:!0}))}return l}})}function settings_slicedToArray(r,l){return function settings_arrayWithHoles(r){if(Array.isArray(r))return r}(r)||function settings_iterableToArrayLimit(r,l){var c=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=c){var u,p,m,h,y=[],v=!0,g=!1;try{if(m=(c=c.call(r)).next,0===l){if(Object(c)!==c)return;v=!1}else for(;!(v=(u=m.call(c)).done)&&(y.push(u.value),y.length!==l);v=!0);}catch(r){g=!0,p=r}finally{try{if(!v&&null!=c.return&&(h=c.return(),Object(h)!==h))return}finally{if(g)throw p}}return y}}(r,l)||function settings_unsupportedIterableToArray(r,l){if(r){if("string"==typeof r)return settings_arrayLikeToArray(r,l);var c={}.toString.call(r).slice(8,-1);return"Object"===c&&r.constructor&&(c=r.constructor.name),"Map"===c||"Set"===c?Array.from(r):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?settings_arrayLikeToArray(r,l):void 0}}(r,l)||function settings_nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function settings_arrayLikeToArray(r,l){(null==l||l>r.length)&&(l=r.length);for(var c=0,u=Array(l);c<l;c++)u[c]=r[c];return u}function registerSettings(){!function registerSettingsArray(r){for(var l=0,u=Object.entries(r);l<u.length;l++){var p=settings_slicedToArray(u[l],2),m=p[0],h=p[1];game.settings.register(c,m,h)}}({showWeaponsItems:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showWeaponsItems.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showWeaponsItems.hint"),scope:"world",config:!0,type:Boolean,default:!1,onChange:function onChange(r){ui.ARGON.constructor.DND5E.itemTypes.consumable=ui.ARGON.constructor.DND5E.itemTypes.consumable.filter(function(r){return"weapon"!==r}),r&&ui.ARGON.constructor.DND5E.itemTypes.consumable.push("weapon"),ui.ARGON.refresh()}},showClassActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showClassActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showClassActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(r){ui.ARGON.constructor.DND5E.mainBarFeatures=ui.ARGON.constructor.DND5E.mainBarFeatures.filter(function(r){return"class"!==r}),r&&ui.ARGON.constructor.DND5E.mainBarFeatures.push("class"),ui.ARGON.refresh()}},condenseClassActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.condenseClassActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.condenseClassActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}},macroPanel:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.macroPanel.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.macroPanel.hint"),scope:"world",config:!0,type:Boolean,default:!1,requiresReload:!0,onChange:function onChange(){return ui.ARGON.refresh()}},switchEquip:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.switchEquip.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.switchEquip.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}},showSpecialActions:{name:game.i18n.localize("enhancedcombathud-dnd5e.settings.showSpecialActions.name"),hint:game.i18n.localize("enhancedcombathud-dnd5e.settings.showSpecialActions.hint"),scope:"world",config:!0,type:Boolean,default:!0,onChange:function onChange(){return ui.ARGON.refresh()}}})}var c="enhancedcombathud-dnd5e";Hooks.on("setup",function(){registerSettings(),initConfig()})})();
//# sourceMappingURL=index.js.map